<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab5_Section2: usb.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab5_Section2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('usb_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">usb.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    @file usb.cpp</span></div><div class="line"><span class="comment">    @brief Simple USB Stack for Kinetis</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    @version  V4.12.1.150</span></div><div class="line"><span class="comment">    @date     13 Nov 2016</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   \verbatim</span></div><div class="line"><span class="comment">    Kinetis USB Code</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Copyright (C) 2008-16  Peter O&#39;Donoghue</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    This program is free software; you can redistribute it and/or modify</span></div><div class="line"><span class="comment">    it under the terms of the GNU General Public License as published by</span></div><div class="line"><span class="comment">    the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><span class="comment">    (at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    This program is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment">    GNU General Public License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment">    along with this program; if not, write to the Free Software</span></div><div class="line"><span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></div><div class="line"><span class="comment">    \endverbatim</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">\verbatim</span></div><div class="line"><span class="comment">Change History</span></div><div class="line"><span class="comment">+=================================================================================</span></div><div class="line"><span class="comment">| 20 Oct 2016 | Created</span></div><div class="line"><span class="comment">+=================================================================================</span></div><div class="line"><span class="comment">\endverbatim</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> * *** DO NOT EDIT THIS FILE ***</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is generated automatically.</span></div><div class="line"><span class="comment"> * Any manual changes will be lost.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="derivative_8h.html">derivative.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="usb_8h.html">usb.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="string_formatter_8h.html">stringFormatter.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a> {</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** BDTs organised by endpoint, odd/even, tx/rx */</span></div><div class="line"><span class="keyword">volatile</span> <a name="_a0"></a><a class="code" href="struct_endpoint_bdt_entry.html">EndpointBdtEntry</a> <a name="a1"></a><a class="code" href="group___u_s_b___group.html#ga6195f5c7b903256ad3a4811e05259da4">endPointBdts</a>[Usb0::NUMBER_OF_ENDPOINTS] __attribute__ ((aligned (512)));</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** End-points in use */</span></div><div class="line">Endpoint *<a name="a2"></a><a class="code" href="group___u_s_b___group.html#gab53d50e0caaad8d86c5cfb0ffc1c6be4">UsbBase::fEndPoints</a>[UsbImplementation::NUMBER_OF_ENDPOINTS];</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef MS_COMPATIBLE_ID_FEATURE</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> uint8_t <a name="a3"></a><a class="code" href="group___u_s_b___group.html#ga605806179b4071a61649fd5753f996fd">UsbBase::fMsOsStringDescriptor</a>[] = {</div><div class="line">      18, <a name="a4"></a><a class="code" href="group___u_s_b___group.html#ggaaf86964e07079f57562728ea953b61c3a4313207b96335e124ddd0664a0794cad">DT_STRING</a>, <span class="charliteral">&#39;M&#39;</span>,0,<span class="charliteral">&#39;S&#39;</span>,0,<span class="charliteral">&#39;F&#39;</span>,0,<span class="charliteral">&#39;T&#39;</span>,0,<span class="charliteral">&#39;1&#39;</span>,0,<span class="charliteral">&#39;0&#39;</span>,0,<span class="charliteral">&#39;0&#39;</span>,0,<a name="a5"></a><a class="code" href="group___u_s_b___group.html#ggae0ce006ca194dd988fe484dac60ae958a709e91728e7ffb6ec6ebb79b916cbf57">GET_MS_FEATURE_DESCRIPTOR</a>,0x00</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// See https://github.com/pbatard/libwdi/wiki/WCID-Devices</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keyword">const</span> <a name="_a6"></a><a class="code" href="struct_m_s___compatible_id_feature_descriptor.html">MS_CompatibleIdFeatureDescriptor</a> <a name="a7"></a><a class="code" href="group___u_s_b___group.html#ga3323e58e907f673ea9061ec3697b8826">msCompatibleIdFeatureDescriptor</a> = {</div><div class="line">      <span class="comment">/* lLength;             */</span>  <a name="a8"></a><a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>((uint32_t)<span class="keyword">sizeof</span>(<a class="code" href="struct_m_s___compatible_id_feature_descriptor.html">MS_CompatibleIdFeatureDescriptor</a>)),</div><div class="line">      <span class="comment">/* wVersion;            */</span>  <a name="a9"></a><a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>((uint16_t)0x0100),</div><div class="line">      <span class="comment">/* wIndex;              */</span>  <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>((uint16_t)0x0004),</div><div class="line">      <span class="comment">/* bnumSections;        */</span>  1,</div><div class="line">      <span class="comment">/* bReserved1[7];       */</span>  {0},</div><div class="line">      <span class="comment">/*---------------------- Section 1 -----------------------------*/</span></div><div class="line">      <span class="comment">/* bInterfaceNum;       */</span>  0,</div><div class="line">      <span class="comment">/* bReserved2;          */</span>  1,</div><div class="line">      <span class="comment">/* bCompatibleId[8];    */</span>  {<span class="charliteral">&#39;W&#39;</span>,<span class="charliteral">&#39;I&#39;</span>,<span class="charliteral">&#39;N&#39;</span>,<span class="charliteral">&#39;U&#39;</span>,<span class="charliteral">&#39;S&#39;</span>,<span class="charliteral">&#39;B&#39;</span>,<span class="charliteral">&#39;\0&#39;</span>,<span class="charliteral">&#39;\0&#39;</span>},</div><div class="line">      <span class="comment">/* bSubCompatibleId[8]; */</span>  {0},</div><div class="line">      <span class="comment">/* bReserved3[6];       */</span>  {0}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">const</span> MS_PropertiesFeatureDescriptor <a name="a10"></a><a class="code" href="group___u_s_b___group.html#ga5c4b1c09fec8648a1fe5a9ac4826e32b">msPropertiesFeatureDescriptor</a> = {</div><div class="line">      <span class="comment">/* uint32_t lLength;         */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>((uint32_t)<span class="keyword">sizeof</span>(MS_PropertiesFeatureDescriptor)),</div><div class="line">      <span class="comment">/* uint16_t wVersion;        */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(0x0100),</div><div class="line">      <span class="comment">/* uint16_t wIndex;          */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(5),</div><div class="line">      <span class="comment">/* uint16_t bnumSections;    */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(2),</div><div class="line">      <span class="comment">/*---------------------- Section 1 -----------------------------*/</span></div><div class="line">      <span class="comment">/* uint32_t lPropertySize0;  */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.lPropertySize0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.ldataType0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wNameLength0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wPropertyLength0)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData0)</div><div class="line">      ),</div><div class="line">      <span class="comment">/* uint32_t ldataType0;       */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(7UL), <span class="comment">// 7 == REG_MULTI_SZ</span></div><div class="line">      <span class="comment">/* uint16_t wNameLength0;     */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName0)),</div><div class="line">      <span class="comment">/* char16_t  bName0[42];      */</span> MS_DEVICE_INTERFACE_GUIDs,</div><div class="line">      <span class="comment">/* uint32_t wPropertyLength0; */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData0)),</div><div class="line">      <span class="comment">/* char16_t  bData0[78];      */</span> MS_DEVICE_GUID,</div><div class="line">      <span class="comment">/*---------------------- Section 2 -----------------------------*/</span></div><div class="line">      <span class="comment">/* uint32_t lPropertySize1;   */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.lPropertySize1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.ldataType1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wNameLength1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.wPropertyLength1)+</div><div class="line">            <span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData1)</div><div class="line">      ),</div><div class="line">      <span class="comment">/* uint32_t ldataType1;       */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(7UL), <span class="comment">// 7 == REG_MULTI_SZ</span></div><div class="line">      <span class="comment">/* uint16_t wNameLength1;     */</span> <a class="code" href="utilities_8h.html#a6239c76fc39b23c0e15f60c978657adf">nativeToLe16</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bName1)),</div><div class="line">      <span class="comment">/* uint8_t  bName1[];         */</span> MS_ICONS,</div><div class="line">      <span class="comment">/* uint32_t wPropertyLength1; */</span> <a class="code" href="utilities_8h.html#a905d8cfd81bad30208494cc171e9e1b2">nativeToLe32</a>(<span class="keyword">sizeof</span>(msPropertiesFeatureDescriptor.bData1)),</div><div class="line">      <span class="comment">/* uint8_t  bData1[];         */</span> MS_ICON_PATH,</div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Get name of USB token</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in]  token USB token</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static string</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a11"></a><a class="code" href="group___u_s_b___group.html#gaf094da3f6dc8c7920d5be5f402b0306a">UsbBase::getTokenName</a>(<span class="keywordtype">unsigned</span> token) {</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *names[] = {</div><div class="line">         <span class="stringliteral">&quot;Unknown #0&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;OUTToken&quot;</span>,   <span class="comment">//  (0x1) - Out token</span></div><div class="line">         <span class="stringliteral">&quot;ACKToken&quot;</span>,   <span class="comment">//  (0x2) - Acknowledge</span></div><div class="line">         <span class="stringliteral">&quot;DATA0Token&quot;</span>, <span class="comment">//  (0x3) - Data 0</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #4&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;SOFToken&quot;</span>,   <span class="comment">//  (0x5) - Start of Frame token</span></div><div class="line">         <span class="stringliteral">&quot;NYETToken&quot;</span>,  <span class="comment">//  (0x6) - No Response Yet</span></div><div class="line">         <span class="stringliteral">&quot;DATA2Token&quot;</span>, <span class="comment">//  (0x7) - Data 2</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #8&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;INToken&quot;</span>,    <span class="comment">//  (0x9) - In token</span></div><div class="line">         <span class="stringliteral">&quot;NAKToken&quot;</span>,   <span class="comment">//  (0xA) - Negative Acknowledge</span></div><div class="line">         <span class="stringliteral">&quot;DATA1Token&quot;</span>, <span class="comment">//  (0xB) - Data 1</span></div><div class="line">         <span class="stringliteral">&quot;PREToken&quot;</span>,   <span class="comment">//  (0xC) - Preamble</span></div><div class="line">         <span class="stringliteral">&quot;SETUPToken&quot;</span>, <span class="comment">//  (0xD) - Setup token</span></div><div class="line">         <span class="stringliteral">&quot;STALLToken&quot;</span>, <span class="comment">//  (0xE) - Stall</span></div><div class="line">         <span class="stringliteral">&quot;MDATAToken&quot;</span>, <span class="comment">//  (0xF) - M data</span></div><div class="line">   };</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *rc = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line">   <span class="keywordflow">if</span> (token&lt;(<span class="keyword">sizeof</span>(names)/<span class="keyword">sizeof</span>(names[0]))) {</div><div class="line">      rc = names[token];</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> rc;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Get name of USB request</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in]  reqType Request type</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static string</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a12"></a><a class="code" href="group___u_s_b___group.html#ga1db43730921b98952b7fd994e8ddb163">UsbBase::getRequestName</a>(uint8_t reqType){</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *names[] = {</div><div class="line">         <span class="stringliteral">&quot;GET_STATUS&quot;</span>,              <span class="comment">/* 0x00 */</span></div><div class="line">         <span class="stringliteral">&quot;CLEAR_FEATURE&quot;</span>,           <span class="comment">/* 0x01 */</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #2&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;SET_FEATURE&quot;</span>,             <span class="comment">/* 0x03 */</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #4&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;SET_ADDRESS&quot;</span>,             <span class="comment">/* 0x05 */</span></div><div class="line">         <span class="stringliteral">&quot;GET_DESCRIPTOR&quot;</span>,          <span class="comment">/* 0x06 */</span></div><div class="line">         <span class="stringliteral">&quot;SET_DESCRIPTOR&quot;</span>,          <span class="comment">/* 0x07 */</span></div><div class="line">         <span class="stringliteral">&quot;GET_CONFIGURATION&quot;</span>,       <span class="comment">/* 0x08 */</span></div><div class="line">         <span class="stringliteral">&quot;SET_CONFIGURATION&quot;</span>,       <span class="comment">/* 0x09 */</span></div><div class="line">         <span class="stringliteral">&quot;GET_INTERFACE&quot;</span>,           <span class="comment">/* 0x0a */</span></div><div class="line">         <span class="stringliteral">&quot;SET_INTERFACE&quot;</span>,           <span class="comment">/* 0x0b */</span></div><div class="line">         <span class="stringliteral">&quot;SYNCH_FRAME&quot;</span>,             <span class="comment">/* 0x0c */</span></div><div class="line">         <span class="stringliteral">&quot;Unknown #D&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;Unknown #E&quot;</span>,</div><div class="line">         <span class="stringliteral">&quot;Unknown #F&quot;</span>,</div><div class="line">   };</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *rc = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line">   <span class="keywordflow">if</span> (reqType&lt;(<span class="keyword">sizeof</span>(names)/<span class="keyword">sizeof</span>(names[0]))) {</div><div class="line">      rc = names[reqType];</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> rc;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Report contents of BDT</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] name    Descriptive name to use</span></div><div class="line"><span class="comment"> * @param[in] bdt     BDT to report</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a13"></a><a class="code" href="group___u_s_b___group.html#ga6ba2132e7da726207caec888b86a3a92">UsbBase::reportBdt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a name="_a14"></a><a class="code" href="struct_bdt_entry.html">BdtEntry</a> *bdt) {</div><div class="line">   (void)name;</div><div class="line">   (void)bdt;</div><div class="line">   <span class="keywordflow">if</span> (bdt-&gt;<a name="a15"></a><a class="code" href="struct_bdt_entry.html#a74933605825f2cacbf37d431356a380d">own</a>) {</div><div class="line">      <a name="a16"></a><a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a17"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(name).</div><div class="line">            <a name="a18"></a><a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot; addr=0x&quot;</span>).write(bdt-&gt;<a name="a19"></a><a class="code" href="struct_bdt_entry.html#ad25182ffafa9a8eb0b86a17028ee0f7a">addr</a>,<a name="a20"></a><a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>).</div><div class="line">            <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;, bc=&quot;</span>).write(bdt-&gt;<a name="a21"></a><a class="code" href="struct_bdt_entry.html#aa4e4e1c284504ce3f75cb15970755972">bc</a>).</div><div class="line">            <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;, &quot;</span>).write(bdt-&gt;<a name="a22"></a><a class="code" href="struct_bdt_entry.html#af7251a06ba55ce32cd52236d93de228e">data0_1</a>?<span class="stringliteral">&quot;DATA1&quot;</span>:<span class="stringliteral">&quot;DATA0&quot;</span>).</div><div class="line">            <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;, &quot;</span>).write(bdt-&gt;<a name="a23"></a><a class="code" href="struct_bdt_entry.html#a3fddf37a2fdb081d30fc0b3d09308ca4">setup</a>.bdt_stall?<span class="stringliteral">&quot;STALL&quot;</span>:<span class="stringliteral">&quot;OK&quot;</span>).</div><div class="line">            writeln(<span class="stringliteral">&quot;USB&quot;</span>);</div><div class="line">   }</div><div class="line">   <span class="keywordflow">else</span> {</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(name).</div><div class="line">            <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot; addr=0x&quot;</span>).write(bdt-&gt;<a class="code" href="struct_bdt_entry.html#ad25182ffafa9a8eb0b86a17028ee0f7a">addr</a>,<a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>).</div><div class="line">            <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;, bc=&quot;</span>).write(bdt-&gt;<a class="code" href="struct_bdt_entry.html#aa4e4e1c284504ce3f75cb15970755972">bc</a>).</div><div class="line">            <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;, &quot;</span>).write(<a class="code" href="group___u_s_b___group.html#gaf094da3f6dc8c7920d5be5f402b0306a">getTokenName</a>(bdt-&gt;<a name="a24"></a><a class="code" href="struct_bdt_entry.html#a309ea534ed4a9c23ff9196f241b162de">result</a>.tok_pid)).</div><div class="line">            writeln(<span class="stringliteral">&quot;PROC&quot;</span>);</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Report line code structure values</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] lineCodingStructure</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a25"></a><a class="code" href="group___u_s_b___group.html#ga6df0f2f02a0be2db85681c6790511704">reportLineCoding</a>(<span class="keyword">const</span> <a name="_a26"></a><a class="code" href="struct_line_coding_structure.html">LineCodingStructure</a> *lineCodingStructure) {</div><div class="line">   (void)lineCodingStructure;</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;rate   = &quot;</span>).<a name="a27"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(lineCodingStructure-&gt;<a name="a28"></a><a class="code" href="struct_line_coding_structure.html#a26727c8652d7ac68431f5857a9f7b8d1">dwDTERate</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;format = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(lineCodingStructure-&gt;<a name="a29"></a><a class="code" href="struct_line_coding_structure.html#a6433de99b826bbf4d4f30da00911f3c5">bCharFormat</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;parity = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(lineCodingStructure-&gt;<a name="a30"></a><a class="code" href="struct_line_coding_structure.html#a0f726286e02df447d1ba9f20174226cf">bParityType</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;bits   = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(lineCodingStructure-&gt;<a name="a31"></a><a class="code" href="struct_line_coding_structure.html#a2bea24b1b35e16ebe506abeeb8e5e233">bDataBits</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Format SETUP packet as string</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in]  p SETUP packet</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Pointer to static buffer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a name="a32"></a><a class="code" href="group___u_s_b___group.html#ga055ac1503ba877346f852f979cd62c7c">UsbBase::getSetupPacketDescription</a>(<a name="_a33"></a><a class="code" href="struct_setup_packet.html">SetupPacket</a> *p) {</div><div class="line"><span class="preprocessor">#ifdef DEBUG_BUILD</span></div><div class="line">   <span class="keyword">static</span> StringFormatter_T&lt;100&gt; sf;</div><div class="line">   sf.clear().</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;[&quot;</span>).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(p-&gt;<a name="a34"></a><a class="code" href="struct_setup_packet.html#a5cdaae68cef911cbf007d99765049eac">bmRequestType</a>, <a name="a35"></a><a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ad82d894095eebc2e1124673811b2c5f6">Radix_2</a>).write(<span class="stringliteral">&quot;,&quot;</span>).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<a class="code" href="group___u_s_b___group.html#ga1db43730921b98952b7fd994e8ddb163">getRequestName</a>(p-&gt;<a name="a36"></a><a class="code" href="struct_setup_packet.html#a358b4fadfa04e79e9747161891e45363">bRequest</a>)).write(<span class="stringliteral">&quot;,&quot;</span>).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(p-&gt;<a name="a37"></a><a class="code" href="struct_setup_packet.html#aa50a7f2174d3739c0dd7daf131765087">wValue</a>, <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>).write(<span class="stringliteral">&quot;,&quot;</span>).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(p-&gt;<a name="a38"></a><a class="code" href="struct_setup_packet.html#acf32f5e5a54de111cf59cfeaabb59a1e">wIndex</a>).write(<span class="stringliteral">&quot;,&quot;</span>).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(p-&gt;<a name="a39"></a><a class="code" href="struct_setup_packet.html#a34cdeb35fde395e236c18d17cc47bf45">wLength</a>).write(<span class="stringliteral">&quot;]&quot;</span>);</div><div class="line">   <span class="keywordflow">return</span> sf.toString();</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">   (void)p;</div><div class="line">   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Report line state value to stdout</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] value</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a40"></a><a class="code" href="group___u_s_b___group.html#ga04cdadfb12a4640973ad9cd5aa856c23">reportLineState</a>(uint8_t value) {</div><div class="line">   (void)value;</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.</div><div class="line">   writeln(<span class="stringliteral">&quot;Line state: RTS=&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>((value&amp;(1&lt;&lt;1))?1:0).</div><div class="line">   <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;DTR=&quot;</span>).writeln((value&amp;(1&lt;&lt;0))?1:0);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> *  Creates a valid string descriptor in UTF-16-LE from a limited UTF-8 string</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  @param[in] to       Where to place descriptor</span></div><div class="line"><span class="comment"> *  @param[in] from     Zero terminated UTF-8 C string</span></div><div class="line"><span class="comment"> *  @param[in] maxSize  Size of destination</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  @note Only handles UTF-8 characters that fit in a single UTF-16 value.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a41"></a><a class="code" href="group___u_s_b___group.html#ga48adf14ccb3d6b55ef5d7ac04d7d5630">UsbBase::utf8ToStringDescriptor</a>(<span class="keyword">volatile</span> uint8_t *to, <span class="keyword">volatile</span> <span class="keyword">const</span> uint8_t *from, <span class="keywordtype">unsigned</span> maxSize) {</div><div class="line">   <span class="keyword">volatile</span> uint8_t *size = to; <span class="comment">// 1st byte is where to place descriptor size</span></div><div class="line"></div><div class="line">   *to++ = 2;         <span class="comment">// 1st byte = descriptor size (2 bytes so far including DT_STRING)</span></div><div class="line">   *to++ = <a class="code" href="group___u_s_b___group.html#ggaaf86964e07079f57562728ea953b61c3a4313207b96335e124ddd0664a0794cad">DT_STRING</a>; <span class="comment">// 2nd byte = descriptor type, DT_STRING;</span></div><div class="line"></div><div class="line">   <span class="keywordflow">while</span> (*from != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line">      <span class="comment">// Buffer for converted character</span></div><div class="line">      uint16_t utf16Char=0;</div><div class="line"></div><div class="line">      <span class="comment">// Update size</span></div><div class="line">      *size  += 2;</div><div class="line">      <span class="keywordflow">if</span> (*from &lt; 0x80) {</div><div class="line">         <span class="comment">// 1-byte UTF-8</span></div><div class="line">         utf16Char = *from++;</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*from &amp;0xE0) == 0xC0){</div><div class="line">         <span class="comment">// 2-byte UTF-8</span></div><div class="line">         utf16Char  = (0x1F&amp;*from++)&lt;&lt;6;</div><div class="line">         utf16Char += (0x3F&amp;*from++);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*from &amp;0xF0) == 0xE0){</div><div class="line">         <span class="comment">// 3-byte UTF-8</span></div><div class="line">         utf16Char  = (0x0F&amp;*from++)&lt;&lt;12;</div><div class="line">         utf16Char += (0x3F&amp;*from++)&lt;&lt;6;</div><div class="line">         utf16Char += (0x3F&amp;*from++);</div><div class="line">      }</div><div class="line">      <span class="comment">// Write UTF-16LE value</span></div><div class="line">      *to++ = (char)utf16Char;</div><div class="line">      *to++ = (char)(utf16Char&gt;&gt;8);</div><div class="line">      <span class="keywordflow">if</span> (*size&gt;=maxSize) {</div><div class="line">         <span class="comment">// Truncate value</span></div><div class="line">         <span class="keywordflow">break</span>;</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line">} <span class="comment">// End namespace USBDM</span></div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 31 2019 16:45:43 for Lab5_Section2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
