<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab5_Section2: fxos8700cq.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab5_Section2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fxos8700cq_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fxos8700cq.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> * @file   fxos8700cq.cpp (180.ARM_Peripherals/Snippets)</span></div><div class="line"><span class="comment"> * @brief  FXOS8700 Accelerometer/Magnetometer interface</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 10/6/2016</span></div><div class="line"><span class="comment"> *      Author: podonoghue</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &quot;fxos8700cq.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="delay_8h.html">delay.h</a>&quot;</span></div><div class="line"> <span class="comment">/*</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> * *** DO NOT EDIT THIS FILE ***</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is generated automatically.</span></div><div class="line"><span class="comment"> * Any manual changes will be lost.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a>;</div><div class="line"></div><div class="line"><span class="comment">// Accelerometer registers</span></div><div class="line"><span class="keyword">enum</span> {</div><div class="line">   <a name="a0"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ab15379688176677d49474245a6178d97">STATUS</a>,</div><div class="line">   <a name="a1"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a87813a56d093ddae9e0768d52633194f">F_STATUS</a> = <a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ab15379688176677d49474245a6178d97">STATUS</a>,</div><div class="line">   <a name="a2"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa43f0acba0be4e749480bd34c5e77106">OUT_X_MSB</a>,</div><div class="line">   <a name="a3"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a550d8565cdb8e995d107c93408d86bd1">OUT_X_LSB</a>,</div><div class="line">   <a name="a4"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a66272921bb91d8dc0c7c45f9b8dce45c">OUT_Y_MSB</a>,</div><div class="line">   <a name="a5"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ae056edd0fffc3109878579d4847d888f">OUT_Y_LSB</a>,</div><div class="line">   <a name="a6"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a61b66745d25a44b079bc63de79a7e18b">OUT_Z_MSB</a>,</div><div class="line">   <a name="a7"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a89177ae3fc65e3d35f12372ad323931a">OUT_Z_LSB</a>,</div><div class="line">   <a name="a8"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a1d412bb14a88e8fb9d88df5c2a128af7">Reservedx07</a>,</div><div class="line">   <a name="a9"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6351c3b61cd6ba88753607f9f6e66fd8">Reservedx08</a>,</div><div class="line">   <a name="a10"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0083057686ebf43f65da948e53c92b00">F_SETUP</a>,</div><div class="line">   <a name="a11"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8e1d5bb575811814f47f0eab9abcfdaa">TRIG_CFG</a>,</div><div class="line">   <a name="a12"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa0f96503796f57f5b078606f0b00886d">SYSMOD</a>,</div><div class="line">   <a name="a13"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ac59b61a6dad337604d6e49ab76dbdca3">INT_SOURCE</a>,</div><div class="line">   <a name="a14"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a14f735baeb4ba7d558ac9caf5439fbeb">WHO_AM_I</a>,</div><div class="line">   <a name="a15"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>,</div><div class="line">   <a name="a16"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a7c04b6f03889dfe7813a30cb888bdd95">HP_FILTER_CUTOFF</a>,</div><div class="line">   <a name="a17"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a66c2525ba1ae53d8c7b345e267d11b98">PL_STATUS</a>,</div><div class="line">   <a name="a18"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a971f13deeef0609438a17d226f62068b">PL_CFG</a>,</div><div class="line">   <a name="a19"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a428aef209079651bd8e5b2fbc21237e8">PL_COUNT</a>,</div><div class="line">   <a name="a20"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ae8993e7195c1fea657dc19e7f2657dba">PL_BF_ZCOMP</a>,</div><div class="line">   <a name="a21"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a131bc88634622ab1b34584156a930a08">P_L_THS_REG</a>,</div><div class="line">   A_FFMT_CFG,</div><div class="line">   A_FFMT_SRC,</div><div class="line">   A_FFMT_THS,</div><div class="line">   A_FFMT_COUNT,</div><div class="line">   <a name="a22"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a127c62d7463b3837b66f481285289cdb">reservedx19</a>,</div><div class="line">   <a name="a23"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549acdd44e58dc5d4f1de46af9c60856654d">reservedx1A</a>,</div><div class="line">   <a name="a24"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a1557daa0e8b45717d71337bdd3a8ee3e">reservedx1B</a>,</div><div class="line">   <a name="a25"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ae602923a3684e888b8ea01b3844dc5d7">reservedx1C</a>,</div><div class="line">   <a name="a26"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa3fb055b4891b8cc1c29b095a0bb792e">TRANSIENT_CFG</a>,</div><div class="line">   <a name="a27"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9e88aea63f5878a7f5bce271f802cf9f">TRANSIENT_SCR</a>,</div><div class="line">   <a name="a28"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6fb641cf8f61241a3e7dccf840c8193c">TRANSIENT_THS</a>,</div><div class="line">   <a name="a29"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a4ce0066418f006c1e7668371249b70cf">TRANSIENT_COUNT</a>,</div><div class="line">   <a name="a30"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8110ced56a40338e5ee78e2e09b03332">PULSE_CFG</a>,</div><div class="line">   <a name="a31"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa5b9c1a373fdca558de05a5960f394bc">PULSE_SRC</a>,</div><div class="line">   <a name="a32"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad0a8bf69021c9e20928d71e973705916">PULSE_THSX</a>,</div><div class="line">   <a name="a33"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a38c69974688f9b9be593e9f648e8abcb">PULSE_THSY</a>,</div><div class="line">   <a name="a34"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aeae0996b2c7b6d3033840b3d324cc9be">PULSE_THSZ</a>,</div><div class="line">   <a name="a35"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a4d9bf502cc2c8b84d63e1434e17df9a3">PULSE_TMLT</a>,</div><div class="line">   <a name="a36"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad2715126a3aa9bef1393f0656a513e22">PULSE_LTCY</a>,</div><div class="line">   <a name="a37"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6eb39bcfbe5c960bb88811f2c2c3a5b3">PULSE_WIND</a>,</div><div class="line">   <a name="a38"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a5b5fc907e1a25482b91eb2e20fe0ed14">ASLP_COUNT</a>,</div><div class="line">   <a name="a39"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>,</div><div class="line">   <a name="a40"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9e33efc02a920e48ed7c6f7468011cf5">CTRL_REG2</a>,</div><div class="line">   <a name="a41"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aff265c077ea00e64b0dd8b83f4fc816b">CTRL_REG3</a>,</div><div class="line">   <a name="a42"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad0970caec5329f62040eb1ecf009bd6a">CTRL_REG4</a>,</div><div class="line">   <a name="a43"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8da306d54b5fe8629fa68da0c658a2af">CTRL_REG5</a>,</div><div class="line">   <a name="a44"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a250a6018734a53db228819569caa64c0">OFF_X</a>,</div><div class="line">   <a name="a45"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a890dd3b2015be663698d66f2b99e1422">OFF_Y</a>,</div><div class="line">   <a name="a46"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0563a9ad886fe619b433a1e7fe0f2652">OFF_Z</a>,</div><div class="line"></div><div class="line">   <span class="comment">// Magnetometer registers (0x32 onwards)</span></div><div class="line">   M_DR_STATUS,</div><div class="line">   M_OUT_X_MSB,</div><div class="line">   M_OUT_X_LSB,</div><div class="line">   M_OUT_Y_MSB,</div><div class="line">   M_OUT_Y_LSB,</div><div class="line">   M_OUT_Z_MSB,</div><div class="line">   M_OUT_Z_LSB,</div><div class="line">   CMP_X_MSB,</div><div class="line">   CMP_X_LSB,</div><div class="line">   CMP_Y_MSB,</div><div class="line">   CMP_Y_LSB,</div><div class="line">   CMP_Z_MSB,</div><div class="line">   CMP_Z_LSB,</div><div class="line">   M_OFF_X_MSB,</div><div class="line">   M_OFF_X_LSB,</div><div class="line">   M_OFF_Y_MSB,</div><div class="line">   M_OFF_Y_LSB,</div><div class="line">   M_OFF_Z_MSB,</div><div class="line">   M_OFF_Z_LSB,</div><div class="line">   MAX_X_MSB,</div><div class="line">   MAX_X_LSB,</div><div class="line">   MAX_Y_MSB,</div><div class="line">   MAX_Y_LSB,</div><div class="line">   MAX_Z_MSB,</div><div class="line">   MAX_Z_LSB,</div><div class="line">   MIN_X_MSB,</div><div class="line">   MIN_X_LSB,</div><div class="line">   MIN_Y_MSB,</div><div class="line">   MIN_Y_LSB,</div><div class="line">   MIN_Z_MSB,</div><div class="line">   MIN_Z_LSB,</div><div class="line">   TEMP,</div><div class="line">   M_THS_CFG,</div><div class="line">   M_THS_SRC,</div><div class="line">   M_THS_X_MSB,</div><div class="line">   M_THS_X_LSB,</div><div class="line">   M_THS_Y_MSB,</div><div class="line">   M_THS_Y_LSB,</div><div class="line">   M_THS_Z_MSB,</div><div class="line">   M_THS_Z_LSB,</div><div class="line">   M_THS_COUNT,</div><div class="line">   M_CTRL_REG1,</div><div class="line">   M_CTRL_REG2,</div><div class="line">   M_CTRL_REG3,</div><div class="line">   M_INT_SRC,</div><div class="line">   A_VECM_CFG,</div><div class="line">   A_VECM_THS_MSB,</div><div class="line">   A_VECM_THS_LSB,</div><div class="line">   A_VECM_CNT,</div><div class="line">   A_VECM_INITX_MSB,</div><div class="line">   A_VECM_INITX_LSB,</div><div class="line">   A_VECM_INITY_MSB,</div><div class="line">   A_VECM_INITY_LSB,</div><div class="line">   A_VECM_INITZ_MSB,</div><div class="line">   A_VECM_INITZ_LSB,</div><div class="line">   M_VECM_CFG,</div><div class="line">   M_VECM_THS_MSB,</div><div class="line">   M_VECM_THS_LSB,</div><div class="line">   M_VECM_CNT,</div><div class="line">   M_VECM_INITX_MSB,</div><div class="line">   M_VECM_INITX_LSB,</div><div class="line">   M_VECM_INITY_MSB,</div><div class="line">   M_VECM_INITY_LSB,</div><div class="line">   M_VECM_INITZ_MSB,</div><div class="line">   M_VECM_INITZ_LSB,</div><div class="line">   A_FFMT_THS_X_MSB,</div><div class="line">   A_FFMT_THS_X_LSB,</div><div class="line">   A_FFMT_THS_Y_MSB,</div><div class="line">   A_FFMT_THS_Y_LSB,</div><div class="line">   A_FFMT_THS_Z_MSB,</div><div class="line">   A_FFMT_THS_Z_LSB,</div><div class="line">   Reservedx79,</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Constructor</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param i2c  - The I2C interface to use</span></div><div class="line"><span class="comment"> * @param mode - Mode of operation (gain and filtering)</span></div><div class="line"><span class="comment"> */</span></div><div class="line">FXOS8700CQ::FXOS8700CQ(<a name="_a47"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html">USBDM::I2c</a> &amp;i2c, AccelerometerMode mode) : i2c(i2c) {</div><div class="line">   failedInit = <span class="keyword">false</span>;</div><div class="line">   <span class="keywordflow">if</span> (readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a14f735baeb4ba7d558ac9caf5439fbeb">WHO_AM_I</a>) != WHO_AM_I_VALUE) {</div><div class="line">      failedInit = <span class="keyword">true</span>;</div><div class="line">      <span class="keywordflow">return</span>;</div><div class="line">   }</div><div class="line">   reset();</div><div class="line"></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aff265c077ea00e64b0dd8b83f4fc816b">CTRL_REG3</a>, 0x00);                                   <span class="comment">// INT0/1 active low, open drain</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad0970caec5329f62040eb1ecf009bd6a">CTRL_REG4</a>, FXOS8700CQ_CTRL_REG4_INT_EN_DRDY_MASK);  <span class="comment">// Enable DRDY Interrupt</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8da306d54b5fe8629fa68da0c658a2af">CTRL_REG5</a>, FXOS8700CQ_CTRL_REG5_INT_CFG_DRDY_MASK); <span class="comment">// Route DRDY to INT1 pin (0=&gt; INT2, 1=&gt; INT1)</span></div><div class="line"></div><div class="line">   writeReg(M_CTRL_REG2, FXOS8700CQ_M_CTRL_REG2_M_HYB_AUTOINC_MODE_MASK); <span class="comment">// Hybrid auto-increment</span></div><div class="line"></div><div class="line">   setAccelerometerMode(mode);</div><div class="line"></div><div class="line"><span class="comment">//   uint8_t buff[5] = {CTRL_REG1};</span></div><div class="line"><span class="comment">//   i2c.txRx(DEVICE_ADDRESS, buff, 1, sizeof(buff));</span></div><div class="line"><span class="comment">//   printf(&quot;FXOS8700CQ, ctrl = 0x%x,0x%x,0x%x,0x%x,0x%x\n&quot;, buff[0], buff[1], buff[2], buff[3], buff[4] );</span></div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Enable accelerometer and/or magnetometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param mode ACCEL_ONLY, MAG_ONLY or ACCEL_MAG</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::enable(Mode mode) {</div><div class="line">   writeReg(M_CTRL_REG1, FXOS8700CQ_M_CTRL_REG1_M_OS(7)|FXOS8700CQ_M_CTRL_REG1_M_HMS(mode));</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Read Accelerometer register</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param regNum  - Register number</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint8_t FXOS8700CQ::readReg(uint8_t regNum) {</div><div class="line">   uint8_t command[] = {regNum};</div><div class="line"></div><div class="line">   i2c.<a name="a48"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(DEVICE_ADDRESS, 1, <span class="keyword">sizeof</span>(command), command);</div><div class="line">   <span class="keywordflow">return</span> command[0];</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Write Accelerometer register</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param regNum  - Register number</span></div><div class="line"><span class="comment"> * @param value   - Value to write</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::writeReg(uint8_t regNum, uint8_t value) {</div><div class="line">   uint8_t command[] = {regNum, value};</div><div class="line"></div><div class="line">   i2c.<a name="a49"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html#af617511a042b33c860d3beb7298a421c">transmit</a>(DEVICE_ADDRESS, <span class="keyword">sizeof</span>(command), command);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Reset Accelerometer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::reset(<span class="keywordtype">void</span>) {</div><div class="line"></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9e33efc02a920e48ed7c6f7468011cf5">CTRL_REG2</a>, FXOS8700CQ_CTRL_REG2_RST_MASK);</div><div class="line"></div><div class="line">   <span class="comment">// Device is not accessible after RESET</span></div><div class="line">   <a name="a50"></a><a class="code" href="namespace_u_s_b_d_m.html#a2068aeafaaba7afea505bc0340865a45">waitUS</a>(1000);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Put accelerometer into Standby mode</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::standby() {</div><div class="line"></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>)&amp;~FXOS8700CQ_CTRL_REG1_ACTIVE_MASK);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Put accelerometer into Active mode</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::active() {</div><div class="line"></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>)|FXOS8700CQ_CTRL_REG1_ACTIVE_MASK);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Obtains measurements from the accelerometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param status  - Indicates status of x, y &amp; z measurements</span></div><div class="line"><span class="comment"> * @param x       - X axis value</span></div><div class="line"><span class="comment"> * @param y       - Y axis value</span></div><div class="line"><span class="comment"> * @param z       - Z axis value</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::readAccelerometerXYZ(<span class="keywordtype">int</span> *status, int16_t *x, int16_t *y, int16_t *z) {</div><div class="line">   uint8_t dataXYZ[7] = {<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ab15379688176677d49474245a6178d97">STATUS</a>};</div><div class="line"></div><div class="line">   <span class="comment">// Receive 7 registers (status, X-high, X-low, Y-high, Y-low, Z-high &amp; Z-low)</span></div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(DEVICE_ADDRESS, 1, <span class="keyword">sizeof</span>(dataXYZ), dataXYZ);</div><div class="line"></div><div class="line">   <span class="comment">// Unpack data and return</span></div><div class="line">   *status = dataXYZ[0];</div><div class="line">   *x = ((int16_t)((dataXYZ[1]&lt;&lt;8)+dataXYZ[2]))&gt;&gt;2;</div><div class="line">   *y = ((int16_t)((dataXYZ[3]&lt;&lt;8)+dataXYZ[4]))&gt;&gt;2;</div><div class="line">   *z = ((int16_t)((dataXYZ[5]&lt;&lt;8)+dataXYZ[6]))&gt;&gt;2;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Set accelerometer mode (gain and filtering)</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param mode - one of ACCEL_2Gmode etc.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::setAccelerometerMode(AccelerometerMode mode) {</div><div class="line">   <span class="comment">// Make inactive</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line"></div><div class="line">   <span class="comment">// Change mode</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>, FXOS8700CQ_XYZ_DATA_CFG_FS(mode));</div><div class="line"></div><div class="line">   <span class="comment">// Make active etc</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>,</div><div class="line">         FXOS8700CQ_CTRL_REG1_ASLP_RATE(0) | <span class="comment">/* 50 Hz auto-sleep rate */</span></div><div class="line">         FXOS8700CQ_CTRL_REG1_DR(2) |        <span class="comment">/* 200 Hz update rate    */</span></div><div class="line">         FXOS8700CQ_CTRL_REG1_ACTIVE_MASK);  <span class="comment">/* Active     */</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Obtains measurements from the Magnetometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param status  - Indicates status of x, y &amp; z measurements</span></div><div class="line"><span class="comment"> * @param x       - X axis value</span></div><div class="line"><span class="comment"> * @param y       - Y axis value</span></div><div class="line"><span class="comment"> * @param z       - Z axis value</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::readMagnetometerXYZ(<span class="keywordtype">int</span> *status, int16_t *x, int16_t *y, int16_t *z) {</div><div class="line">   uint8_t dataXYZ[7] = {M_DR_STATUS};</div><div class="line"></div><div class="line">   <span class="comment">// Receive 7 registers (status, X-high, X-low, Y-high, Y-low, Z-high &amp; Z-low)</span></div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(DEVICE_ADDRESS, 1, <span class="keyword">sizeof</span>(dataXYZ), dataXYZ);</div><div class="line"></div><div class="line">   <span class="comment">// Unpack data and return (data is sign extended)</span></div><div class="line">   *status = dataXYZ[0];</div><div class="line">   *x = ((dataXYZ[1]&lt;&lt;8)+dataXYZ[2]);</div><div class="line">   *y = ((dataXYZ[3]&lt;&lt;8)+dataXYZ[4]);</div><div class="line">   *z = ((dataXYZ[5]&lt;&lt;8)+dataXYZ[6]);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Set magnetometer mode (gain and filtering)</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param mode - one of 2Gmode etc.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::setMagnetometerMode(ControlReg2Mode mode) {</div><div class="line">   writeReg(M_CTRL_REG2, mode|FXOS8700CQ_M_CTRL_REG2_M_HYB_AUTOINC_MODE_MASK);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Obtains measurements from the Accelerometer &amp; Magnetometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param data  Reference to structure to contain values read</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::readAll(Data &amp;data) {</div><div class="line">   uint8_t dataXYZ[13] = {<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>};</div><div class="line"></div><div class="line">   <span class="comment">// Receive 14 registers (accelerometerStatus, X-high/low, Y-high/low, Z-high/low,</span></div><div class="line">   <span class="comment">//                       magnetometerStatus, X-high/low, Y-high/low, Z-high/low)</span></div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(DEVICE_ADDRESS, 1, <span class="keyword">sizeof</span>(dataXYZ), dataXYZ);</div><div class="line">   data.accelerometerStatus = dataXYZ[0];</div><div class="line">   data.accelerometer_X     = ((dataXYZ[1]&lt;&lt;8)+dataXYZ[2]);</div><div class="line">   data.accelerometer_Y     = ((dataXYZ[3]&lt;&lt;8)+dataXYZ[4]);</div><div class="line">   data.accelerometer_Z     = ((dataXYZ[5]&lt;&lt;8)+dataXYZ[6]);</div><div class="line">   data.magnetometerStatus = dataXYZ[7];</div><div class="line">   data.magnetometer_X      = ((dataXYZ[7]&lt;&lt;8)+dataXYZ[8]);</div><div class="line">   data.magnetometer_Y      = ((dataXYZ[9]&lt;&lt;8)+dataXYZ[10]);</div><div class="line">   data.magnetometer_Z      = ((dataXYZ[10]&lt;&lt;8)+dataXYZ[11]);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> * Read ID from accelerometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return ID value as 8-bit number (0x1A for MMA8451Q)</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint32_t FXOS8700CQ::readID(<span class="keywordtype">void</span>) {</div><div class="line">   uint8_t values[] = {<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a14f735baeb4ba7d558ac9caf5439fbeb">WHO_AM_I</a>};</div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(DEVICE_ADDRESS, 1, <span class="keyword">sizeof</span>(values), values);</div><div class="line">   <span class="keywordflow">return</span> values[0];</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Calibrate accelerometer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::calibrateAccelerometer() {</div><div class="line"></div><div class="line">   uint8_t originalControlReg1Value = readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>);</div><div class="line">   uint8_t originalXYXDataConfigValue = readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Make inactive so setting can be modified</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line"></div><div class="line">   <span class="comment">// Clear existing offsets</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a250a6018734a53db228819569caa64c0">OFF_X</a>, 0);</div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a890dd3b2015be663698d66f2b99e1422">OFF_Y</a>, 0);</div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0563a9ad886fe619b433a1e7fe0f2652">OFF_Z</a>, 0);</div><div class="line"></div><div class="line">   <span class="keywordtype">int</span> mode = (originalXYXDataConfigValue&amp;FXOS8700CQ_XYZ_DATA_CFG_FS_MASK)&gt;&gt;FXOS8700CQ_XYZ_DATA_CFG_FS_OFF;</div><div class="line"></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> calibration2Gs[]     = {4096*8, 2048*8, 1024*8};</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> calibrationFactors[] = {8*8, 4*8, 2*8};</div><div class="line"></div><div class="line">   <span class="keywordtype">int</span> calibration2G     = calibration2Gs[mode];</div><div class="line">   <span class="keywordtype">int</span> calibrationFactor = calibrationFactors[mode];</div><div class="line"></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>,</div><div class="line">         FXOS8700CQ_CTRL_REG1_ASLP_RATE(0) | <span class="comment">/* 50 Hz auto-sleep rate */</span></div><div class="line">         FXOS8700CQ_CTRL_REG1_DR(2) |        <span class="comment">/* 200 Hz update rate    */</span></div><div class="line">         FXOS8700CQ_CTRL_REG1_ACTIVE_MASK);  <span class="comment">/* Active     */</span></div><div class="line"></div><div class="line">   int16_t Xout_Accel_14_bit, Yout_Accel_14_bit, Zout_Accel_14_bit;</div><div class="line">   <span class="keywordtype">int</span>     Xout_Accel=0, Yout_Accel=0, Zout_Accel=0;</div><div class="line"></div><div class="line">   <span class="comment">// Average 8 samples to reduce noise</span></div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;8; i++) {</div><div class="line">      <span class="keywordtype">int</span> status;</div><div class="line">      <span class="keywordflow">do</span> {</div><div class="line">         readAccelerometerXYZ(&amp;status, &amp;Xout_Accel_14_bit, &amp;Yout_Accel_14_bit, &amp;Zout_Accel_14_bit);</div><div class="line">      } <span class="keywordflow">while</span> ((status &amp; FXOS8700CQ_STATUS_XYZDR_MASK) == 0);</div><div class="line">      Xout_Accel += Xout_Accel_14_bit;</div><div class="line">      Yout_Accel += Yout_Accel_14_bit;</div><div class="line">      Zout_Accel += Zout_Accel_14_bit;</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Make inactive so setting can be modified</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line"></div><div class="line">   <span class="keywordtype">char</span> X_Accel_offset = -(Xout_Accel / calibrationFactor);                    <span class="comment">// Compute X-axis offset correction value</span></div><div class="line">   <span class="keywordtype">char</span> Y_Accel_offset = -(Yout_Accel / calibrationFactor);                    <span class="comment">// Compute Y-axis offset correction value</span></div><div class="line">   <span class="keywordtype">char</span> Z_Accel_offset = -((Zout_Accel - calibration2G) / calibrationFactor);  <span class="comment">// Compute Z-axis offset correction value</span></div><div class="line"></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a250a6018734a53db228819569caa64c0">OFF_X</a>, X_Accel_offset);</div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a890dd3b2015be663698d66f2b99e1422">OFF_Y</a>, Y_Accel_offset);</div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0563a9ad886fe619b433a1e7fe0f2652">OFF_Z</a>, Z_Accel_offset);</div><div class="line"></div><div class="line">   <span class="comment">// Restore original settings</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, originalControlReg1Value);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Simple calibration of magnetometer</span></div><div class="line"><span class="comment"> * Requires user to rotate the board in all dimensions</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param time How long to run calibration in seconds</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> FXOS8700CQ::calibrateMagnetometer(<span class="keywordtype">int</span> time) {</div><div class="line"></div><div class="line">   uint8_t originalMControlReg1Value = readReg(M_CTRL_REG1);</div><div class="line">   uint8_t originalControlReg1Value  = readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>);</div><div class="line"></div><div class="line"><span class="comment">//   uint8_t buff[6] = {M_OFF_X_MSB};</span></div><div class="line"><span class="comment">//   i2c.txRx(DEVICE_ADDRESS, buff, 1, sizeof(buff));</span></div><div class="line"><span class="comment">//   printf(&quot;FXOS8700CQ, m_offset = 0x%02x%02x, 0x%02x%02x, 0x%02x%02x,\n&quot;, buff[0], buff[1], buff[2], buff[3], buff[4], buff[5] );</span></div><div class="line"></div><div class="line">   <span class="comment">// Make inactive so setting can be changed</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>,</div><div class="line">         FXOS8700CQ_CTRL_REG1_ASLP_RATE(0) | <span class="comment">// 50 Hz auto-sleep rate</span></div><div class="line">         FXOS8700CQ_CTRL_REG1_DR(6) |        <span class="comment">// 6.25 Hz update rate (assuming mag only)</span></div><div class="line">         FXOS8700CQ_CTRL_REG1_ACTIVE_MASK);  <span class="comment">// Active</span></div><div class="line">   writeReg(M_CTRL_REG1,</div><div class="line">         FXOS8700CQ_M_CTRL_REG1_M_ACAL_MASK|       <span class="comment">// Magnetic hard-iron offset auto-calibration enabled</span></div><div class="line">         FXOS8700CQ_M_CTRL_REG1_M_OS(7)|           <span class="comment">// Maximum over-sample</span></div><div class="line">         FXOS8700CQ_M_CTRL_REG1_M_HMS(MAG_ONLY));  <span class="comment">// Magnetometer only</span></div><div class="line"></div><div class="line">   <span class="comment">// Samples @ 6.35 Hz</span></div><div class="line">   <a name="a51"></a><a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(time*1000);</div><div class="line"></div><div class="line"><span class="comment">//   buff[0] = M_OFF_X_MSB;</span></div><div class="line"><span class="comment">//   i2c.txRx(DEVICE_ADDRESS, buff, 1, sizeof(buff));</span></div><div class="line"><span class="comment">//   printf(&quot;FXOS8700CQ, m_offset = 0x%02x%02x, 0x%02x%02x, 0x%02x%02x,\n&quot;, buff[0], buff[1], buff[2], buff[3], buff[4], buff[5] );</span></div><div class="line"></div><div class="line">   <span class="comment">// Make inactive so setting can be changed</span></div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line">   <span class="comment">// Restore original settings</span></div><div class="line">   writeReg(M_CTRL_REG1, originalMControlReg1Value);</div><div class="line">   writeReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, originalControlReg1Value);</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 31 2019 16:45:42 for Lab5_Section2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
