<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab5_Section2: dma-uart-example-mk28f.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab5_Section2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dma-uart-example-mk28f_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">dma-uart-example-mk28f.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> * @file    dma-uart-example-mk28f.cpp (180.ARM_Peripherals/Snippets)</span></div><div class="line"><span class="comment"> * @brief   DMA example using UART and PIT throttling</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 10/1/2016</span></div><div class="line"><span class="comment"> *      Author: podonoghue</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> */</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * This example uses DMA to transfer characters from a string to the UART for transmission.</span></div><div class="line"><span class="comment"> * The speed of transmission is throttled by the use of PIT triggering the DMA channel (DmaMux).</span></div><div class="line"><span class="comment"> * The transmission is made continuous by setting up the TCD appropriately:</span></div><div class="line"><span class="comment"> * - Not clearing the DREQ on transfer complete</span></div><div class="line"><span class="comment"> * - Arranging SLAST to return the transfer addresses to starting value after each major-loop.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This example requires interrupts to be enabled in the USBDM configuration for the following:</span></div><div class="line"><span class="comment"> * - DMA</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The LED should be assigned to a suitable GPIO</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * It may also be necessary to adjust DMA_SLOT for the console UART.</span></div><div class="line"><span class="comment"> *    DmaSlot_UART0_Transmit =&gt; DmaSlot_UART?_Transmit</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * If the console uses a LPUART then other changes are necessary:</span></div><div class="line"><span class="comment"> *    DmaSlot_UART0_Transmit =&gt; DmaSlot_LPUART?_Transmit</span></div><div class="line"><span class="comment"> *    UartDma_TxHoldingEmpty =&gt; LpuartDma_TxHoldingEmpty</span></div><div class="line"><span class="comment"> *    console.uart-&gt;D        =&gt; console.lpuart-&gt;DATA</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hardware_8h.html">hardware.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dma_8h.html">dma.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="pit_8h.html">pit.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="smc_8h.html">smc.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mcg_8h.html">mcg.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a>;</div><div class="line"></div><div class="line"><span class="comment">// Slot number to use (must agree with console UART)</span></div><div class="line"><span class="keyword">static</span> constexpr <a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#ga5b50a0a241f752e58cb84650aaa39052">DmaSlot</a> DMA_SLOT = Dma0SlotLow_LPUART0_Tx;</div><div class="line"></div><div class="line"><span class="comment">// MCG clocks for various run modes</span></div><div class="line"><span class="keyword">static</span> constexpr <a class="code" href="group___m_c_g___group.html#ga7a3f88aee696150f11131655b5060278">ClockConfig</a> VLPR_MODE  = <a name="a0"></a><a class="code" href="group___m_c_g___group.html#gga7a3f88aee696150f11131655b5060278a6ff12f95c136ff8d6cca0466aa43022d">ClockConfig_BLPE_4MHz</a>;</div><div class="line"><span class="keyword">static</span> constexpr <a class="code" href="group___m_c_g___group.html#ga7a3f88aee696150f11131655b5060278">ClockConfig</a> RUN_MODE   = ClockConfig_PEE_120MHz;</div><div class="line"><span class="keyword">static</span> constexpr <a class="code" href="group___m_c_g___group.html#ga7a3f88aee696150f11131655b5060278">ClockConfig</a> HSRUN_MODE = ClockConfig_PEE_150MHz;</div><div class="line"></div><div class="line"><span class="comment">// Used to indicate complete transfer</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> complete;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> message[]=</div><div class="line">      <span class="stringliteral">&quot;=================================\n\r&quot;</span></div><div class="line">      <span class="stringliteral">&quot; Hello world from DMA controller \n\r&quot;</span></div><div class="line">      <span class="stringliteral">&quot;=================================\n\r&quot;</span>;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @verbatim</span></div><div class="line"><span class="comment"> * +------------------------------+            Simple DMA mode (MLNO = Minor Loop Mapping Disabled)</span></div><div class="line"><span class="comment"> * | Major Loop =                 |            ==================================================</span></div><div class="line"><span class="comment"> * |    CITER x Minor Loop        |</span></div><div class="line"><span class="comment"> * |                              |            Each DMA request triggers a minor-loop transfer sequence.</span></div><div class="line"><span class="comment"> * | +--------------------------+ |&lt;-DMA Req.  The minor loops are counted in the major-loop.</span></div><div class="line"><span class="comment"> * | | Minor Loop               | |</span></div><div class="line"><span class="comment"> * | | Each transfer            | |            The following are used during a minor loop:</span></div><div class="line"><span class="comment"> * | |   SADDR-&gt;DADDR           | |             - SADDR Source address</span></div><div class="line"><span class="comment"> * | |   SADDR += SOFF          | |             - SOFF  Adjustment applied to SADDR after each transfer</span></div><div class="line"><span class="comment"> * | |   DADDR += DOFF          | |             - DADDR Destination address</span></div><div class="line"><span class="comment"> * | | Total transfer is NBYTES | |             - DOFF  Adjustment applied to DADDR after each transfer</span></div><div class="line"><span class="comment"> * | +--------------------------+ |             - NBYTES Number of bytes to transfer</span></div><div class="line"><span class="comment"> * | +--------------------------+ |&lt;-DMA Req.   - Attributes</span></div><div class="line"><span class="comment"> * | | Minor Loop               | |               - ATTR_SSIZE, ATTR_DSIZE Source and destination transfer sizes</span></div><div class="line"><span class="comment"> * |..............................|               - ATTR_SMOD, ATTR_DMOD Modulo</span></div><div class="line"><span class="comment"> * | |                          | |</span></div><div class="line"><span class="comment"> * | +--------------------------+ |             The number of reads and writes done will depend on NBYTES, SSIZE and DSIZE</span></div><div class="line"><span class="comment"> * | +--------------------------+ |&lt;-DMA Req.   For example: NBYTES=12, SSIZE=16-bits, DSIZE=32-bits =&gt; 6 reads, 3 writes</span></div><div class="line"><span class="comment"> * | | Minor Loop               | |             NBYTES must be an even multiple of SSIZE and DSIZE in bytes.</span></div><div class="line"><span class="comment"> * | | Each transfer            | |</span></div><div class="line"><span class="comment"> * | |   SADDR-&gt;DADDR           | |            The following are used by the major loop</span></div><div class="line"><span class="comment"> * | |   SADDR += SOFF          | |             - SLAST Adjustment applied to SADDR at the end of each major loop</span></div><div class="line"><span class="comment"> * | |   DADDR += DOFF          | |             - DLAST Adjustment applied to DADDR at the end of each major loop</span></div><div class="line"><span class="comment"> * | | Total transfer is NBYTES | |             - CITER Major loop counter - counts how many completed major loops</span></div><div class="line"><span class="comment"> * | +--------------------------+ |</span></div><div class="line"><span class="comment"> * |                              |            SLAST and DLAST may be used to reset the addresses to the initial value or</span></div><div class="line"><span class="comment"> * | At end of Major Loop         |            link to the next transfer.</span></div><div class="line"><span class="comment"> * |    SADDR += SLAST            |            The total transferred for the entire sequence is CITER x NBYTES.</span></div><div class="line"><span class="comment"> * |    DADDR += DLAST            |</span></div><div class="line"><span class="comment"> * |                              |            Important options in the CSR:</span></div><div class="line"><span class="comment"> * | Total transfer =             |              - DMA_CSR_INTMAJOR = Generate interrupt at end of Major-loop</span></div><div class="line"><span class="comment"> * |    CITER*NBYTES              |              - DMA_CSR_DREQ     = Clear hardware request at end of Major-loop</span></div><div class="line"><span class="comment"> * +------------------------------+              - DMA_CSR_START    = Start transfer. Used for software transfers. Automatically cleared.</span></div><div class="line"><span class="comment"> * @endverbatim</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Structure to define the DMA transfer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> constexpr <a name="_a1"></a><a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> tcd = <a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> (</div><div class="line">   <span class="comment">/* Source address                 */</span> (uint32_t)(message),           <span class="comment">// Source array</span></div><div class="line">   <span class="comment">/* Source offset                  */</span> <span class="keyword">sizeof</span>(message[0]),            <span class="comment">// Source address advances 1 element for each request</span></div><div class="line">   <span class="comment">/* Source size                    */</span> <a name="a2"></a><a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(message[0]),           <span class="comment">// 8-bit read from source address</span></div><div class="line">   <span class="comment">/* Source modulo                  */</span> <a name="a3"></a><a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,            <span class="comment">// Disabled</span></div><div class="line">   <span class="comment">/* Last source adjustment         */</span> -(<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(message),         <span class="comment">// Reset source address to start of array on completion</span></div><div class="line"></div><div class="line">   <span class="comment">/* Destination address            */</span> <a name="a4"></a><a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a5"></a><a class="code" href="class_u_s_b_d_m_1_1_uart___t.html#afbba2514a59a031f3646db24cf8fae26">uartD</a>(),               <span class="comment">// Destination is UART data register</span></div><div class="line">   <span class="comment">/* Destination offset             */</span> 0,                             <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line">   <span class="comment">/* Destination size               */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(message[0]),           <span class="comment">// 8-bit write to destination address</span></div><div class="line">   <span class="comment">/* Destination modulo             */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,            <span class="comment">// Disabled</span></div><div class="line">   <span class="comment">/* Last destination adjustment    */</span> 0,                             <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line"></div><div class="line">   <span class="comment">/* Minor loop byte count          */</span> <a name="a6"></a><a class="code" href="group___d_m_a___group.html#ga3ac933fd1a1b5eefd5e96a9eeebb71e3">dmaNBytes</a>(<span class="keyword">sizeof</span>(message[0])), <span class="comment">// Total transfer in one minor-loop</span></div><div class="line">   <span class="comment">/* Major loop count               */</span> <a name="a7"></a><a class="code" href="group___d_m_a___group.html#gac6e553966ce0ccdbb184d77317f48045">dmaCiter</a>((<span class="keyword">sizeof</span>(message))/    <span class="comment">// Transfer entire buffer</span></div><div class="line">   <span class="comment">/*                                */</span>           <span class="keyword">sizeof</span>(message[0])),</div><div class="line"></div><div class="line">   <span class="comment">/* Start channel                  */</span> <span class="keyword">false</span>,                         <span class="comment">// Don&#39;t start (triggered by hardware)</span></div><div class="line">   <span class="comment">/* Disable Req. on major complete */</span> <span class="keyword">false</span>,                         <span class="comment">// Don&#39;t clear hardware request when major loop completed</span></div><div class="line">   <span class="comment">/* Interrupt on major complete    */</span> <span class="keyword">true</span>,                          <span class="comment">// Generate interrupt on completion of Major-loop</span></div><div class="line">   <span class="comment">/* Interrupt on half complete     */</span> <span class="keyword">false</span>,                         <span class="comment">// No interrupt</span></div><div class="line">   <span class="comment">/* Bandwidth (speed) Control      */</span> <a name="a8"></a><a class="code" href="group___d_m_a___group.html#ggaeb59b0776210eb819e37188e948348c6ab57167f9dc828222f9194199a4fb4178">DmaSpeed_NoStalls</a>              <span class="comment">// Full speed</span></div><div class="line">);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * DMA error call back</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param errorFlags Channel error information (DMA_ES)</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> dmaErrorCallbackFunction(uint32_t errorFlags) {</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a9"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;DMA error DMA_ES = 0x&quot;</span>).<a name="a10"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(errorFlags, <a name="a11"></a><a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ad82d894095eebc2e1124673811b2c5f6">Radix_2</a>);</div><div class="line">   <a name="a12"></a><a class="code" href="group___c_m_s_i_s___core___instruction_interface.html#ga15ea6bd3c507d3e81c3b3a1258e46397">__BKPT</a>();</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * DMA complete callback</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Sets flag to indicate sequence complete.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dmaCallback(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> channel) {</div><div class="line">   <span class="comment">// Clear status</span></div><div class="line">   <a name="a13"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a9cabbf85d0da0a95d7b7e55f02daedc3">Dma0::clearInterruptRequest</a>(channel);</div><div class="line">   <span class="comment">// Stop UART requests</span></div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a14"></a><a class="code" href="class_u_s_b_d_m_1_1_uart.html#a99ac8f38206c86a8ab3d22de90ac6372">enableDma</a>(LpuartDma_TxHoldingEmpty, <span class="keyword">false</span>);</div><div class="line">   <span class="comment">// Flag complete to main-line</span></div><div class="line">   complete = <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Configure DMA from Memory-to-UART</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param dmaChannel  Pre-allocated DMA channel to use.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> configureDma(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaChannel) {</div><div class="line"></div><div class="line">   <span class="comment">// Sequence not complete yet</span></div><div class="line">   complete = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">   <span class="comment">// Enable DMAC</span></div><div class="line">   <span class="comment">// Note: These settings affect all DMA channels</span></div><div class="line">   <a name="a15"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a9a1448e4443619ba45e7d28b36c24711">Dma0::configure</a>(</div><div class="line">         <a name="a16"></a><a class="code" href="group___d_m_a___group.html#ggaad8ebd716832392d090e3d98a811043dafcd0c5aa8e319fabb871b8cf337edd3a">DmaOnError_Halt</a>,</div><div class="line">         <a name="a17"></a><a class="code" href="group___d_m_a___group.html#gga1e32105c1992aa7566e1c86aab3199a3acabf796f11b061ad3626e13a0fce5542">DmaMinorLoopMapping_Disabled</a>,</div><div class="line">         <a name="a18"></a><a class="code" href="group___d_m_a___group.html#gga0d95df55def92de5ef69629c371fe2f4a462e21c56655b2dfdc3e2a7370dbc021">DmaContinuousLink_Disabled</a>,</div><div class="line">         <a name="a19"></a><a class="code" href="group___d_m_a___group.html#ggacb2afe357b15d2f1534fab5ef2f87819a899703e1120f3cb43ae3643654b1cd77">DmaArbitration_Fixed</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Set callback (Interrupts are enabled in TCD)</span></div><div class="line">   <a name="a20"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ac26b60d5e5132a384cfe047d79ef798a">Dma0::setCallback</a>(dmaChannel, dmaCallback);</div><div class="line">   <a name="a21"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a3be24e24ff27bc55eb37d2a068d847cc">Dma0::setErrorCallback</a>(dmaErrorCallbackFunction);</div><div class="line">   <a name="a22"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#afa8f41553743a7e10bccdc40d6eaeb5a">Dma0::enableNvicInterrupts</a>(dmaChannel, <a name="a23"></a><a class="code" href="hardware_8h.html#a7c8f445c1595473f9c473c29c30f47c8a484f3c1e0f4b27d3327f8d8f2f820009">NvicPriority_Normal</a>);</div><div class="line">   <a name="a24"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a67e6f794c9e66718cb311a5991f197c2">Dma0::enableNvicErrorInterrupt</a>();</div><div class="line"></div><div class="line">   <span class="comment">// Connect DMA channel to UART but throttle by PIT Channel N (matches DMA channel N)</span></div><div class="line">   <a name="a25"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_mux___t.html#a16ec126a63c1258d96b7c83e9088a531">DmaMux0::configure</a>(dmaChannel, DMA_SLOT, <a name="a26"></a><a class="code" href="group___d_m_a___group.html#ggaf45af97259922f16e01ad5cbe09cfe4aa6e05da33d3e5a3118340df0a9b1bb9c1">DmaMuxEnable_Triggered</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Configure the transfer</span></div><div class="line">   <a name="a27"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#af6d178f2b901c5edaebe6f2bf5086cce">Dma0::configureTransfer</a>(dmaChannel, tcd);</div><div class="line"></div><div class="line">   <span class="comment">// Enable hardware requests</span></div><div class="line">   <a name="a28"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ad52210f7989479ed83e4824d6da69cef">Dma0::enableRequests</a>(dmaChannel);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DMA_EARS_EDREQ_0_MASK</span></div><div class="line">   <span class="comment">// Enable asynchronous requests (if available)</span></div><div class="line">   Dma0::enableAsynchronousRequests(dmaChannel);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">   <span class="comment">// Enable channel interrupt requests</span></div><div class="line">   <a name="a29"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a6a0911bfa8f2e5711d661010fb249c05">Dma0::enableErrorInterrupts</a>(dmaChannel);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Configure the PIT</span></div><div class="line"><span class="comment"> * - Generates regular events which throttles the DMA -&gt; UART Tx.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param dmaChannel  PIT channel being used.  Must be associated with DMA channel.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> configurePit(<a class="code" href="group___p_i_t___group.html#gaaee78b5330274d8c8ff79e43bfa19eea">PitChannelNum</a> pitChannel) {</div><div class="line">   <span class="comment">// Configure base PIT</span></div><div class="line">   <a name="a30"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#a8ffb60de00f511c28ff41dcfba30b462">Pit::configure</a>(<a name="a31"></a><a class="code" href="group___p_i_t___group.html#ggafbef6818d22b8e4baffdcda3cfce827ca3a15ca2ba448d18e4dd834c8a68732c7">PitDebugMode_Stop</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Configure channel for 100ms + interrupts</span></div><div class="line">   <a name="a32"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#a414fd98ccded726f2302cd62fd932ae6">Pit::configureChannel</a>(pitChannel, 100*<a name="a33"></a><a class="code" href="namespace_u_s_b_d_m.html#a17a57c09bf294a3b85baeaad11e6e941">ms</a>, <a name="a34"></a><a class="code" href="group___p_i_t___group.html#gga90e158ebdf2bd8630018cdd1204a7e45a228b7e87ff69638c684d276f1e8cf631">PitChannelIrq_Enabled</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Change run mode</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] smcRunMode Run mode to enter</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> changeRunMode(<a class="code" href="group___s_m_c___group.html#ga8f7d25c07186f16274f2bfdb53e12979">SmcRunMode</a> smcRunMode) {</div><div class="line">   <span class="comment">// Get current run mode</span></div><div class="line">   <a class="code" href="group___s_m_c___group.html#ga3ad1095ea418d174a12df332f95365fb">SmcStatus</a> smcStatus = <a name="a35"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#a3a0f473afc13ef6e185d0a6cf0bb7651">Smc::getStatus</a>();</div><div class="line"></div><div class="line">   <span class="comment">// Check if transition needed</span></div><div class="line">   <span class="keywordflow">if</span> (((smcStatus == SmcStatus_hsrun) &amp;&amp; (smcRunMode == <a name="a36"></a><a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a9c0f0c9f01ad76bc4cd479113900ea4a">SmcRunMode_HighSpeed</a>)) ||</div><div class="line">       ((smcStatus == <a name="a37"></a><a class="code" href="group___s_m_c___group.html#gga3ad1095ea418d174a12df332f95365fba6d8658393b06d15a63fc6de40d7cd92d">SmcStatus_RUN</a>) &amp;&amp; (smcRunMode == <a name="a38"></a><a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979aeb20fb3bcf7aa42bdfacd5a41274bbe2">SmcRunMode_Normal</a>)) ||</div><div class="line">       ((smcStatus == <a name="a39"></a><a class="code" href="group___s_m_c___group.html#gga3ad1095ea418d174a12df332f95365fbad65b5f0bb9f9c5aed17b9366ae2d31f2">SmcStatus_VLPR</a>) &amp;&amp; (smcRunMode == <a name="a40"></a><a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a7998b987c42ac18b97b80ac3f04e2856">SmcRunMode_VeryLowPower</a>))) {</div><div class="line">      <span class="keywordflow">return</span>;</div><div class="line">   }</div><div class="line">   <span class="comment">// If changing go via RUN</span></div><div class="line">   <span class="keywordflow">if</span> (smcStatus == SmcStatus_hsrun) {</div><div class="line">      <span class="comment">// Do HSRUN-&gt;RUN</span></div><div class="line">      <a name="a41"></a><a class="code" href="class_u_s_b_d_m_1_1_mcg.html#ab626a700a6ba2514c09517bef8892b69">Mcg::configure</a>(RUN_MODE);</div><div class="line">      <a name="a42"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#aaac7fbc92025d0a6286038c941aa1cff">Smc::enterRunMode</a>(<a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979aeb20fb3bcf7aa42bdfacd5a41274bbe2">SmcRunMode_Normal</a>);</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a43"></a><a class="code" href="class_u_s_b_d_m_1_1_uart__brfa___t.html#a91e27d012dbf3855adc031d7758b5190">setBaudRate</a>(<a name="a44"></a><a class="code" href="group___c_o_n_s_o_l_e___group.html#ga22ce8c6952a0f55472bca315a2ef642e">defaultBaudRate</a>);</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Changed to RUN mode, &quot;</span>).<a name="a45"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">   }</div><div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smcStatus == <a class="code" href="group___s_m_c___group.html#gga3ad1095ea418d174a12df332f95365fbad65b5f0bb9f9c5aed17b9366ae2d31f2">SmcStatus_VLPR</a>) {</div><div class="line">      <span class="comment">// Do VLPR-&gt;RUN mode</span></div><div class="line">      <a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#aaac7fbc92025d0a6286038c941aa1cff">Smc::enterRunMode</a>(<a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979aeb20fb3bcf7aa42bdfacd5a41274bbe2">SmcRunMode_Normal</a>);</div><div class="line">      <a class="code" href="class_u_s_b_d_m_1_1_mcg.html#ab626a700a6ba2514c09517bef8892b69">Mcg::configure</a>(RUN_MODE);</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart__brfa___t.html#a91e27d012dbf3855adc031d7758b5190">setBaudRate</a>(<a class="code" href="group___c_o_n_s_o_l_e___group.html#ga22ce8c6952a0f55472bca315a2ef642e">defaultBaudRate</a>);</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Changed to RUN mode, &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Now in RUN mode</span></div><div class="line">   <span class="keywordflow">switch</span>(smcRunMode) {</div><div class="line">      <span class="keywordflow">case</span> <a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a9c0f0c9f01ad76bc4cd479113900ea4a">SmcRunMode_HighSpeed</a>:</div><div class="line">         <span class="comment">// RUN-&gt;HSRUN</span></div><div class="line">         <a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#aaac7fbc92025d0a6286038c941aa1cff">Smc::enterRunMode</a>(<a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a9c0f0c9f01ad76bc4cd479113900ea4a">SmcRunMode_HighSpeed</a>);</div><div class="line">         <a class="code" href="class_u_s_b_d_m_1_1_mcg.html#ab626a700a6ba2514c09517bef8892b69">Mcg::configure</a>(HSRUN_MODE);</div><div class="line">         <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart__brfa___t.html#a91e27d012dbf3855adc031d7758b5190">setBaudRate</a>(<a class="code" href="group___c_o_n_s_o_l_e___group.html#ga22ce8c6952a0f55472bca315a2ef642e">defaultBaudRate</a>);</div><div class="line">         <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Changed to HSRUN mode, &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">         <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">      <span class="keywordflow">case</span> <a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979aeb20fb3bcf7aa42bdfacd5a41274bbe2">SmcRunMode_Normal</a>:</div><div class="line">         <span class="comment">// Complete</span></div><div class="line">         <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">      <span class="keywordflow">case</span> <a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a7998b987c42ac18b97b80ac3f04e2856">SmcRunMode_VeryLowPower</a>:</div><div class="line">         <span class="comment">// RUN-&gt;VLPR</span></div><div class="line">         <a class="code" href="class_u_s_b_d_m_1_1_mcg.html#ab626a700a6ba2514c09517bef8892b69">Mcg::configure</a>(VLPR_MODE);</div><div class="line">         <a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#aaac7fbc92025d0a6286038c941aa1cff">Smc::enterRunMode</a>(<a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a7998b987c42ac18b97b80ac3f04e2856">SmcRunMode_VeryLowPower</a>);</div><div class="line">         <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart__brfa___t.html#a91e27d012dbf3855adc031d7758b5190">setBaudRate</a>(<a class="code" href="group___c_o_n_s_o_l_e___group.html#ga22ce8c6952a0f55472bca315a2ef642e">defaultBaudRate</a>);</div><div class="line">         <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Changed to VLPR mode, &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">         <span class="keywordflow">break</span>;</div><div class="line">   }</div><div class="line"></div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<a name="a46"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#a119f74471c7ba5394304f10b245d00c6">Smc::getSmcStatusName</a>()).</div><div class="line">         <a name="a47"></a><a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;:&quot;</span>).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<a name="a48"></a><a class="code" href="class_u_s_b_d_m_1_1_mcg.html#a80b5ba2ad8891bcbc80e63b36e33be22">Mcg::getClockModeName</a>()).</div><div class="line">         <a class="code" href="_port_expander_8h.html#af67279d9d9f86870f16275b030f4188a">write</a>(<span class="stringliteral">&quot;@&quot;</span>).writeln(::<a name="a49"></a><a class="code" href="system_8h.html#aa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a50"></a><a class="code" href="mma845x-example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line"></div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;\nStarting\n&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line"></div><div class="line">   <span class="comment">// Re-configure LPUART as clocks change during example</span></div><div class="line">   SimInfo::setLpuartClock(SimLpuartClockSource_McgIrClk);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart__brfa___t.html#a91e27d012dbf3855adc031d7758b5190">setBaudRate</a>(<a class="code" href="group___c_o_n_s_o_l_e___group.html#ga22ce8c6952a0f55472bca315a2ef642e">defaultBaudRate</a>, 4);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Changed LPUART clock source\n&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line"></div><div class="line">   <span class="comment">// Allow entry to other RUN modes</span></div><div class="line">   <a name="a51"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#a3045fd7755d24a8d4a80f2d3a1276c8a">Smc::enablePowerModes</a>(</div><div class="line">         <a name="a52"></a><a class="code" href="group___s_m_c___group.html#ggaba25d67336820a5d04723a6cbe06939fa461f7cc5151b5d4ff7e4899ce3f7a8c8">SmcVeryLowPower_Enabled</a>,</div><div class="line">         <a name="a53"></a><a class="code" href="group___s_m_c___group.html#gga8d9f07974996e41350162690c9ad9271a82ea4049786733e2d39d1c6573c7b11f">SmcLowLeakageStop_Enabled</a>,</div><div class="line">         <a name="a54"></a><a class="code" href="group___s_m_c___group.html#gga38e5f4cf64d5141f065bfdbeff7f9c67af5147895b5e75bf92b97858b742daa42">SmcVeryLowLeakageStop_Enabled</a>,</div><div class="line">         <a name="a55"></a><a class="code" href="group___s_m_c___group.html#ggaffadc8fbac22923f33b098ced40731eda906c59bc1c74a26f5585c94a6105d84a">SmcHighSpeedRun_Enabled</a>);</div><div class="line"></div><div class="line">   <span class="comment">// DMA channel number to use (determines which PIT channel used)</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaChannel = <a name="a56"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a48be2c9ab4c7613402a34e8676484b6a">Dma0::allocatePeriodicChannel</a>();</div><div class="line">   <span class="keywordflow">if</span> (dmaChannel == <a name="a57"></a><a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19aba1b991e9afaf9f9455ffe9ff7b8a92d">DmaChannelNum_None</a>) {</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Failed to allocate DMA channel, rc= &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<a name="a58"></a><a class="code" href="namespace_u_s_b_d_m.html#af5406ca776612b2687e916fb194ffd26a530f47258a51fceb0908aaa6b19ce0ad">E_NO_RESOURCE</a>);</div><div class="line">      __asm__(<span class="stringliteral">&quot;bkpt&quot;</span>);</div><div class="line">   }</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Allocated DMA channel  #&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(dmaChannel);</div><div class="line"></div><div class="line">   <span class="comment">// Set up throttled DMA transfer from memory -&gt; UART</span></div><div class="line">   configureDma(dmaChannel);</div><div class="line"></div><div class="line">   <span class="comment">// Get Pit channel associated with DMA channel</span></div><div class="line">   <a class="code" href="group___p_i_t___group.html#gaaee78b5330274d8c8ff79e43bfa19eea">PitChannelNum</a> pitChannel = <a name="a59"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#afa693feef478c59034959c2d057690e3">Pit::allocateDmaAssociatedChannel</a>(dmaChannel);</div><div class="line">   <span class="keywordflow">if</span> (pitChannel == <a name="a60"></a><a class="code" href="group___p_i_t___group.html#ggaaee78b5330274d8c8ff79e43bfa19eeaa5261a6d6041c30c7f3a5a34e5744473d">PitChannelNum_None</a>) {</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Failed to allocate PIT channel, rc= &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<a class="code" href="namespace_u_s_b_d_m.html#af5406ca776612b2687e916fb194ffd26a530f47258a51fceb0908aaa6b19ce0ad">E_NO_RESOURCE</a>);</div><div class="line">      __asm__(<span class="stringliteral">&quot;bkpt&quot;</span>);</div><div class="line">   }</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Allocated PIT channel  #&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(pitChannel);</div><div class="line">   configurePit(pitChannel);</div><div class="line"></div><div class="line">   <span class="comment">// Start the UART DMA requests</span></div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Doing 1 DMA transfer while in RUN&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart.html#a99ac8f38206c86a8ab3d22de90ac6372">enableDma</a>(LpuartDma_TxHoldingEmpty);</div><div class="line"></div><div class="line">   <span class="comment">// Wait for completion of 1 Major-loop = 1 message</span></div><div class="line">   <span class="keywordflow">while</span> (!complete) {</div><div class="line">      __asm__(<span class="stringliteral">&quot;nop&quot;</span>);</div><div class="line">   }</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Done 1st transfer&quot;</span>);</div><div class="line">   <a name="a61"></a><a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(500);</div><div class="line"></div><div class="line">   <span class="comment">// RUN-&gt;VLPR</span></div><div class="line">   changeRunMode(<a class="code" href="group___s_m_c___group.html#gga8f7d25c07186f16274f2bfdb53e12979a7998b987c42ac18b97b80ac3f04e2856">SmcRunMode_VeryLowPower</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Re-configure PIT as bus clock may have changed</span></div><div class="line">   configurePit(pitChannel);</div><div class="line"></div><div class="line">   <span class="comment">// Start the UART DMA requests again</span></div><div class="line">   complete = <span class="keyword">false</span>;</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;\nDoing DMA while in VLPR....&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart.html#a99ac8f38206c86a8ab3d22de90ac6372">enableDma</a>(LpuartDma_TxHoldingEmpty);</div><div class="line"></div><div class="line">   <span class="comment">// Wait for completion of 1 Major-loop = 1 message</span></div><div class="line">   <span class="keywordflow">while</span> (!complete) {</div><div class="line">      __asm__(<span class="stringliteral">&quot;nop&quot;</span>);</div><div class="line">   }</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Done 2nd transfer&quot;</span>);</div><div class="line">   <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(500);</div><div class="line"></div><div class="line">   <a name="a62"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#a904811707c75ec2904788554961c5e28">Smc::setStopOptions</a>(</div><div class="line">         <a name="a63"></a><a class="code" href="group___s_m_c___group.html#gga31a9c3ee4669c3706c0f9de4124ba133a7e8a058eac7e7324cfc210e8c550b684">SmcLowLeakageStopMode_LLS3</a>,   <span class="comment">// Retains RAM</span></div><div class="line">         <a name="a64"></a><a class="code" href="group___s_m_c___group.html#gga15af011a9ffe1a128eec8ed58e753cdca38af15b130337a225871055ac62751d0">SmcPowerOnReset_Enabled</a>,       <span class="comment">// Brown-out detection</span></div><div class="line">         <a name="a65"></a><a class="code" href="group___s_m_c___group.html#gga62d64069c2d4c664fcf5545c21fa6810a01f85de4f7fb8b1399a624a174995486">SmcPartialStopMode_Partial2</a>,  <span class="comment">// Bus clock active (for DMAC)</span></div><div class="line">         SmcLpoInLowLeakage_Disabled);  <span class="comment">// LPO stops in LLS/VLLS</span></div><div class="line"></div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;\nDoing DMA while deep-sleeping....&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      <span class="comment">// Enable UART Tx DMA requests</span></div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_uart.html#a99ac8f38206c86a8ab3d22de90ac6372">enableDma</a>(LpuartDma_TxHoldingEmpty);</div><div class="line"></div><div class="line">      <span class="comment">//Smc::enterWaitMode();</span></div><div class="line">      <a name="a66"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#a649f4d5725d8773731f5f0ed484b2cba">Smc::enterStopMode</a>(<a name="a67"></a><a class="code" href="group___s_m_c___group.html#ggae98572aa728af3ae8d7b73ea8809a944a369e20ff4de8eaaa896d3a7a79a8362d">SmcStopMode_NormalStop</a>);</div><div class="line"></div><div class="line">      <span class="comment">// Will wake up after each complete transfer due to DMA complete interrupt</span></div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Woke up!&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#ad198391c6d91ca8e666df31ee11b2aa1">flushOutput</a>();</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 31 2019 16:45:42 for Lab5_Section2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
