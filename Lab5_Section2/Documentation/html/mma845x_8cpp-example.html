<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab5_Section2: mma845x.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab5_Section2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mma845x_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mma845x.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @file mma845x.cpp</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 22/11/2013</span></div><div class="line"><span class="comment"> *      Author: podonoghue</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mma845x_8h.html">mma845x.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="delay_8h.html">delay.h</a>&quot;</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> * *** DO NOT EDIT THIS FILE ***</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is generated automatically.</span></div><div class="line"><span class="comment"> * Any manual changes will be lost.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_ACTIVE_MASK         (1&lt;&lt;0)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_F_READ_MASK         (1&lt;&lt;1)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_LNOISE_MASK         (1&lt;&lt;2)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_DR_OFF              (3)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_DR_MASK             (0x7&lt;&lt;MMA845x_CTRL_REG1_DR_OFF)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_DR(x)               (((x)&lt;&lt;MMA845x_CTRL_REG1_DR_OFF)&amp;MMA845x_CTRL_REG1_DR_MASK)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_ASLP_RATE_OFF       (6)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_ASLP_RATE_MASK      (0x3F&lt;&lt;MMA845x_CTRL_REG1_ASLP_RATE_OFF)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG1_ASLP_RATE(x)        (((x)&lt;&lt;MMA845x_CTRL_REG1_ASLP_RATE_OFF)&amp;MMA845x_CTRL_REG1_ASLP_RATE_MASK)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_MODS_OFF            (0)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_MODS_MASK           (0x3&lt;&lt;MMA845x_CTRL_REG1_DR_OFF)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_MODS(x)             (((x)&lt;&lt;MMA845x_CTRL_REG1_DR_OFF)&amp;MMA845x_CTRL_REG1_DR_MASK)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_SLPE_MASK           (1&lt;&lt;2)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_SMODS_OFF           (3)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_SMODS_MASK          (0x3&lt;&lt;MMA845x_CTRL_REG1_DR_OFF)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_SMODS(x)            (((x)&lt;&lt;MMA845x_CTRL_REG1_DR_OFF)&amp;MMA845x_CTRL_REG1_DR_MASK)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_RST_MASK            (1&lt;&lt;6)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG2_ST_MASK             (1&lt;&lt;7)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_PP_OD_MASK          (1&lt;&lt;0)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_IPOL_MASK           (1&lt;&lt;1)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_WAKE_A_VECM_MASK    (1&lt;&lt;2)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_WAKE_FFMT_MASK      (1&lt;&lt;3)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_WAKE_PULSE_MASK     (1&lt;&lt;4)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_WAKE_INDPRT_MASK    (1&lt;&lt;5)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_WAKE_TRANS_MASK     (1&lt;&lt;6)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG3_FIFO_GATE_MASK      (1&lt;&lt;7)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_DRDY_MASK    (1&lt;&lt;0)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_A_VECM_MASK  (1&lt;&lt;1)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_EN_FFMT_MASK (1&lt;&lt;2)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_PULSE_MASK   (1&lt;&lt;3)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_INDPRT_MASK  (1&lt;&lt;4)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_TRANS_MASK   (1&lt;&lt;5)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_FIFO_MASK    (1&lt;&lt;6)</span></div><div class="line"><span class="preprocessor">#define MMA845x_CTRL_REG4_INT_EN_ASLP_MASK    (1&lt;&lt;7)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MMA845x_XYZ_DATA_CFG_FS_OFF           (0)</span></div><div class="line"><span class="preprocessor">#define MMA845x_XYZ_DATA_CFG_FS_MASK          (0x03&lt;&lt;MMA845x_XYZ_DATA_CFG_FS_OFF)</span></div><div class="line"><span class="preprocessor">#define MMA845x_XYZ_DATA_CFG_FS(x)            (((x)&lt;&lt;MMA845x_XYZ_DATA_CFG_FS_OFF)&amp;MMA845x_XYZ_DATA_CFG_FS_MASK)</span></div><div class="line"><span class="preprocessor">#define MMA845x_XYZ_DATA_CFG_HPF_OUT_MASK     (1&lt;&lt;4)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MMA845x_STATUS_ZYXDR_MASK   (1&lt;&lt;3)</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Accelerometer registers</span></div><div class="line"><span class="keyword">enum</span> {</div><div class="line">   <a name="a0"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ab15379688176677d49474245a6178d97">STATUS</a>,</div><div class="line">   <a name="a1"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a87813a56d093ddae9e0768d52633194f">F_STATUS</a> = <a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ab15379688176677d49474245a6178d97">STATUS</a>,</div><div class="line">   <a name="a2"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa43f0acba0be4e749480bd34c5e77106">OUT_X_MSB</a>,</div><div class="line">   <a name="a3"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a550d8565cdb8e995d107c93408d86bd1">OUT_X_LSB</a>,</div><div class="line">   <a name="a4"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a66272921bb91d8dc0c7c45f9b8dce45c">OUT_Y_MSB</a>,</div><div class="line">   <a name="a5"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ae056edd0fffc3109878579d4847d888f">OUT_Y_LSB</a>,</div><div class="line">   <a name="a6"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a61b66745d25a44b079bc63de79a7e18b">OUT_Z_MSB</a>,</div><div class="line">   <a name="a7"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a89177ae3fc65e3d35f12372ad323931a">OUT_Z_LSB</a>,</div><div class="line">   <a name="a8"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a1d412bb14a88e8fb9d88df5c2a128af7">Reservedx07</a>,</div><div class="line">   <a name="a9"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6351c3b61cd6ba88753607f9f6e66fd8">Reservedx08</a>,</div><div class="line">   <a name="a10"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0083057686ebf43f65da948e53c92b00">F_SETUP</a>,</div><div class="line">   <a name="a11"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8e1d5bb575811814f47f0eab9abcfdaa">TRIG_CFG</a>,</div><div class="line">   <a name="a12"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa0f96503796f57f5b078606f0b00886d">SYSMOD</a>,</div><div class="line">   <a name="a13"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ac59b61a6dad337604d6e49ab76dbdca3">INT_SOURCE</a>,</div><div class="line">   <a name="a14"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a14f735baeb4ba7d558ac9caf5439fbeb">WHO_AM_I</a>,</div><div class="line">   <a name="a15"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>,</div><div class="line">   <a name="a16"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a7c04b6f03889dfe7813a30cb888bdd95">HP_FILTER_CUTOFF</a>,</div><div class="line">   <a name="a17"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a66c2525ba1ae53d8c7b345e267d11b98">PL_STATUS</a>,</div><div class="line">   <a name="a18"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a971f13deeef0609438a17d226f62068b">PL_CFG</a>,</div><div class="line">   <a name="a19"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a428aef209079651bd8e5b2fbc21237e8">PL_COUNT</a>,</div><div class="line">   <a name="a20"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ae8993e7195c1fea657dc19e7f2657dba">PL_BF_ZCOMP</a>,</div><div class="line">   <a name="a21"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a131bc88634622ab1b34584156a930a08">P_L_THS_REG</a>,</div><div class="line">   <a name="a22"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a4ca86f203151955d7b1f10b90c07059f">FF_MT_CFG</a>,</div><div class="line">   <a name="a23"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a7eadac19cd7417f4efc8cec3254711a3">FF_MT_SRC</a>,</div><div class="line">   <a name="a24"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6d0a395d8a620a0af360a3008443b9b2">FF_MT_THS</a>,</div><div class="line">   <a name="a25"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9491c916e7af9ad10c286168d5aba87e">FF_MT_COUNT</a>,</div><div class="line">   <a name="a26"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a127c62d7463b3837b66f481285289cdb">reservedx19</a>,</div><div class="line">   <a name="a27"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549acdd44e58dc5d4f1de46af9c60856654d">reservedx1A</a>,</div><div class="line">   <a name="a28"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a1557daa0e8b45717d71337bdd3a8ee3e">reservedx1B</a>,</div><div class="line">   <a name="a29"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ae602923a3684e888b8ea01b3844dc5d7">reservedx1C</a>,</div><div class="line">   <a name="a30"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa3fb055b4891b8cc1c29b095a0bb792e">TRANSIENT_CFG</a>,</div><div class="line">   <a name="a31"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9e88aea63f5878a7f5bce271f802cf9f">TRANSIENT_SCR</a>,</div><div class="line">   <a name="a32"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6fb641cf8f61241a3e7dccf840c8193c">TRANSIENT_THS</a>,</div><div class="line">   <a name="a33"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a4ce0066418f006c1e7668371249b70cf">TRANSIENT_COUNT</a>,</div><div class="line">   <a name="a34"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8110ced56a40338e5ee78e2e09b03332">PULSE_CFG</a>,</div><div class="line">   <a name="a35"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aa5b9c1a373fdca558de05a5960f394bc">PULSE_SRC</a>,</div><div class="line">   <a name="a36"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad0a8bf69021c9e20928d71e973705916">PULSE_THSX</a>,</div><div class="line">   <a name="a37"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a38c69974688f9b9be593e9f648e8abcb">PULSE_THSY</a>,</div><div class="line">   <a name="a38"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aeae0996b2c7b6d3033840b3d324cc9be">PULSE_THSZ</a>,</div><div class="line">   <a name="a39"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a4d9bf502cc2c8b84d63e1434e17df9a3">PULSE_TMLT</a>,</div><div class="line">   <a name="a40"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad2715126a3aa9bef1393f0656a513e22">PULSE_LTCY</a>,</div><div class="line">   <a name="a41"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a6eb39bcfbe5c960bb88811f2c2c3a5b3">PULSE_WIND</a>,</div><div class="line">   <a name="a42"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a5b5fc907e1a25482b91eb2e20fe0ed14">ASLP_COUNT</a>,</div><div class="line">   <a name="a43"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>,</div><div class="line">   <a name="a44"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9e33efc02a920e48ed7c6f7468011cf5">CTRL_REG2</a>,</div><div class="line">   <a name="a45"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aff265c077ea00e64b0dd8b83f4fc816b">CTRL_REG3</a>,</div><div class="line">   <a name="a46"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ad0970caec5329f62040eb1ecf009bd6a">CTRL_REG4</a>,</div><div class="line">   <a name="a47"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a8da306d54b5fe8629fa68da0c658a2af">CTRL_REG5</a>,</div><div class="line">   <a name="a48"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a250a6018734a53db228819569caa64c0">OFF_X</a>,</div><div class="line">   <a name="a49"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a890dd3b2015be663698d66f2b99e1422">OFF_Y</a>,</div><div class="line">   <a name="a50"></a><a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0563a9ad886fe619b433a1e7fe0f2652">OFF_Z</a>,</div><div class="line">};</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Constructor</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] i2c                - The I2C interface to use</span></div><div class="line"><span class="comment"> * @param[in] accelerometerMode  - Mode of operation (gain and filtering)</span></div><div class="line"><span class="comment"> * @param[in] cr1                - Data rate etc (see cr1Value())</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a name="a51"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#aad86097e9fa3cbc467c04013b17020ff">MMA845x::MMA845x</a>(<a name="_a52"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html">USBDM::I2c</a> &amp;i2c, AccelerometerMode accelerometerMode, uint8_t cr1) : i2c(i2c) {</div><div class="line">   <span class="keywordflow">if</span> (readReg(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a14f735baeb4ba7d558ac9caf5439fbeb">WHO_AM_I</a>) != WHO_AM_I_VALUE) {</div><div class="line">      <a name="a53"></a><a class="code" href="namespace_u_s_b_d_m.html#a8fa1fae9ec2f8c7ba1897a2561cb971c">setErrorCode</a>(<a name="a54"></a><a class="code" href="namespace_u_s_b_d_m.html#af5406ca776612b2687e916fb194ffd26a312fd11e9b744e70aeb30ef5c99d687b">E_NO_COMMUNICATION</a>);</div><div class="line">      <span class="keywordflow">return</span>;</div><div class="line">   }</div><div class="line">   reset();</div><div class="line">   configure(accelerometerMode, cr1);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Read Accelerometer register</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] regNum  - Register number</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint8_t <a name="a55"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#ae58f650c2161250e17d47f5d1b18ce4d">MMA845x::readReg</a>(uint8_t regNum) {</div><div class="line">   uint8_t command[1];</div><div class="line">   i2c.<a name="a56"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(<a name="a57"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6364c3b10a4fb3483a52f5209033d0c6">DEVICE_ADDRESS</a>, 1, &amp;regNum, <span class="keyword">sizeof</span>(command), command);</div><div class="line">   <span class="keywordflow">return</span> command[0];</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Write Accelerometer register</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] regNum  - Register number</span></div><div class="line"><span class="comment"> * @param[in] value   - Value to write</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a58"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">MMA845x::writeReg</a>(uint8_t regNum, uint8_t value) {</div><div class="line">   uint8_t command[] = {regNum, value};</div><div class="line"></div><div class="line">   i2c.<a name="a59"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html#af617511a042b33c860d3beb7298a421c">transmit</a>(<a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6364c3b10a4fb3483a52f5209033d0c6">DEVICE_ADDRESS</a>, <span class="keyword">sizeof</span>(command), command);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Reset Accelerometer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a60"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a53286cdcde0c798cb0f123f5c6480064">MMA845x::reset</a>(<span class="keywordtype">void</span>) {</div><div class="line"></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a9e33efc02a920e48ed7c6f7468011cf5">CTRL_REG2</a>, <a name="a61"></a><a class="code" href="mma845x_8cpp.html#a8c260ab1837d9085167c3bc71efc2b26">MMA845x_CTRL_REG2_RST_MASK</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Device is not accessible after RESET</span></div><div class="line">   <a name="a62"></a><a class="code" href="namespace_u_s_b_d_m.html#a2068aeafaaba7afea505bc0340865a45">waitUS</a>(1000);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Put accelerometer into Standby mode</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a63"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a2458762696f1177188bbdc5c00251998">MMA845x::standby</a>() {</div><div class="line"></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#ae58f650c2161250e17d47f5d1b18ce4d">readReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>)&amp;~<a name="a64"></a><a class="code" href="mma845x_8cpp.html#ab2c2041ace65a10e0cb74944c67e5b1e">MMA845x_CTRL_REG1_ACTIVE_MASK</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Put accelerometer into Active mode</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a65"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a180e12972728c63110e17bfe8ce7925a">MMA845x::active</a>() {</div><div class="line"></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#ae58f650c2161250e17d47f5d1b18ce4d">readReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>)|<a class="code" href="mma845x_8cpp.html#ab2c2041ace65a10e0cb74944c67e5b1e">MMA845x_CTRL_REG1_ACTIVE_MASK</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Obtains measurements from the accelerometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[out] status  - Indicates status of x, y &amp; z measurements</span></div><div class="line"><span class="comment"> * @param[out] x       - X axis as 16-bit signed value (14-bit range)</span></div><div class="line"><span class="comment"> * @param[out] y       - Y axis as 16-bit signed value (14-bit range)</span></div><div class="line"><span class="comment"> * @param[out] z       - Z axis as 16-bit signed value (14-bit range)</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @note Waits until a new measurement is available.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a66"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#acb5f3c34f3e20dc3853694f604c385ea">MMA845x::readAccelerometerXYZ</a>(<span class="keywordtype">int</span> &amp;status, int16_t &amp;x, int16_t &amp;y, int16_t &amp;z) {</div><div class="line">   uint8_t dataXYZ[7] = {<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549ab15379688176677d49474245a6178d97">STATUS</a>};</div><div class="line"></div><div class="line">   <span class="keywordflow">do</span> {</div><div class="line">      <span class="comment">// Receive 7 registers (status, X-high, X-low, Y-high, Y-low, Z-high &amp; Z-low)</span></div><div class="line">      i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(<a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6364c3b10a4fb3483a52f5209033d0c6">DEVICE_ADDRESS</a>, 1, <span class="keyword">sizeof</span>(dataXYZ), dataXYZ);</div><div class="line">   } <span class="keywordflow">while</span> ((dataXYZ[0] &amp; <a name="a67"></a><a class="code" href="mma845x_8cpp.html#a8f1bfe48b30657e813de637092bcc3cf">MMA845x_STATUS_ZYXDR_MASK</a>) == 0);</div><div class="line"></div><div class="line">   <span class="comment">// Unpack data and return</span></div><div class="line">   <span class="comment">// X,Y &amp; Z values are sign-extended to 16-bit values</span></div><div class="line">   status = dataXYZ[0];</div><div class="line">   x = ((int16_t)((dataXYZ[1]&lt;&lt;8)+dataXYZ[2]))&gt;&gt;2;</div><div class="line">   y = ((int16_t)((dataXYZ[3]&lt;&lt;8)+dataXYZ[4]))&gt;&gt;2;</div><div class="line">   z = ((int16_t)((dataXYZ[5]&lt;&lt;8)+dataXYZ[6]))&gt;&gt;2;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Configure accelerometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] accelerometerMode - One of ACCEL_2Gmode etc.</span></div><div class="line"><span class="comment"> * @param[in] cr1               - Data rate etc (see cr1Value())</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> <a name="a68"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6e8e02b846e7cce062bac1150bbc54f1">MMA845x::configure</a>(<a name="a69"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#ae6727d3070bd00e50e98ef05835562a6">AccelerometerMode</a> accelerometerMode, uint8_t cr1) {</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>, accelerometerMode);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, cr1);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> * Read ID from accelerometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return ID value as 8-bit number (0x1A for MMA8451Q)</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint32_t <a name="a70"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#af6e198fb2142863f539b2bc2242fb554">MMA845x::readID</a>(<span class="keywordtype">void</span>) {</div><div class="line">   uint8_t values[] = {<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a14f735baeb4ba7d558ac9caf5439fbeb">WHO_AM_I</a>};</div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#ac32bb140084355bc7298773af68edc9d">txRx</a>(<a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6364c3b10a4fb3483a52f5209033d0c6">DEVICE_ADDRESS</a>, 1, <span class="keyword">sizeof</span>(values), values);</div><div class="line">   <span class="keywordflow">return</span> values[0];</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Calibrate accelerometer</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This assumes the accelerometer is level and stationary.</span></div><div class="line"><span class="comment"> * If the accelerometer is too far from level then no correction is applied and error returned</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return E_NO_ERROR       Success</span></div><div class="line"><span class="comment"> * @return E_CALIBRATE_FAIL Calibration failed</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a class="code" href="namespace_u_s_b_d_m.html#af5406ca776612b2687e916fb194ffd26">ErrorCode</a> <a name="a71"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a2ad423e326e2c8b7064ac519f4ba59ff">MMA845x::calibrateAccelerometer</a>() {</div><div class="line"></div><div class="line">   uint8_t originalControlReg1Value   = <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#ae58f650c2161250e17d47f5d1b18ce4d">readReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>);</div><div class="line">   uint8_t originalXYXDataConfigValue = <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#ae58f650c2161250e17d47f5d1b18ce4d">readReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549aef226f10e66222b576e9f218eb378255">XYZ_DATA_CFG</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Make inactive so setting can be modified</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x00);</div><div class="line"></div><div class="line">   <span class="comment">// Clear existing offsets</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint8_t clearOffsets[] = {<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a250a6018734a53db228819569caa64c0">OFF_X</a>, 0, 0, 0};</div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#af617511a042b33c860d3beb7298a421c">transmit</a>(<a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6364c3b10a4fb3483a52f5209033d0c6">DEVICE_ADDRESS</a>, <span class="keyword">sizeof</span>(clearOffsets), clearOffsets);</div><div class="line"></div><div class="line">   <span class="keywordtype">int</span> mode = (originalXYXDataConfigValue&amp;<a name="a72"></a><a class="code" href="mma845x_8cpp.html#a5204a0baea1ac159ac3742cf637ff9f1">MMA845x_XYZ_DATA_CFG_FS_MASK</a>)&gt;&gt;<a name="a73"></a><a class="code" href="mma845x_8cpp.html#a10dfc0453058edc72b33f4de018dcdd2">MMA845x_XYZ_DATA_CFG_FS_OFF</a>;</div><div class="line"></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> calibration2Gs[]     = {4096*8, 2048*8, 1024*8};</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> calibrationFactors[] = {8*8, 4*8, 2*8};</div><div class="line"></div><div class="line">   <span class="keywordtype">int</span> calibration2G     = calibration2Gs[mode];</div><div class="line">   <span class="keywordtype">int</span> calibrationFactor = calibrationFactors[mode];</div><div class="line"></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, <a name="a74"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a97a7438181cb91c819f849e2a9b9d9c4">cr1Value</a>(<a name="a75"></a><a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a22e9dec8c59ecfd880437ccdd9463719adf75c90abc57eebefcd6b4f085577827">AccelDataRate_200Hz</a>));</div><div class="line"></div><div class="line">   int16_t Xout_Accel_14_bit, Yout_Accel_14_bit, Zout_Accel_14_bit;</div><div class="line">   <span class="keywordtype">int</span>     Xout_Accel=0, Yout_Accel=0, Zout_Accel=0;</div><div class="line"></div><div class="line">   <span class="comment">// Average 8 samples to reduce noise</span></div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;8; i++) {</div><div class="line">      <span class="keywordtype">int</span> status;</div><div class="line">      <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#acb5f3c34f3e20dc3853694f604c385ea">readAccelerometerXYZ</a>(status, Xout_Accel_14_bit, Yout_Accel_14_bit, Zout_Accel_14_bit);</div><div class="line">      Xout_Accel += Xout_Accel_14_bit;</div><div class="line">      Yout_Accel += Yout_Accel_14_bit;</div><div class="line">      Zout_Accel += Zout_Accel_14_bit;</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Calculate correction</span></div><div class="line">   Xout_Accel = -(Xout_Accel / calibrationFactor);</div><div class="line">   Yout_Accel = -(Yout_Accel / calibrationFactor);</div><div class="line">   Zout_Accel = -((Zout_Accel - calibration2G) / calibrationFactor);</div><div class="line"></div><div class="line">   <span class="comment">// Check if 8-bit 2&#39;s complement correction is in range</span></div><div class="line">   <span class="keywordtype">bool</span> rangeError = (Xout_Accel&lt;-128) || (Xout_Accel&gt;127) || (Yout_Accel&lt;-128) || (Yout_Accel&gt;127) || (Zout_Accel&lt;-128) || (Zout_Accel&gt;127);</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (rangeError) {</div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="namespace_u_s_b_d_m.html#a8fa1fae9ec2f8c7ba1897a2561cb971c">setErrorCode</a>(<a name="a76"></a><a class="code" href="namespace_u_s_b_d_m.html#af5406ca776612b2687e916fb194ffd26a1ff24dfbeb5e664f1e400e1dde7b3085">E_CALIBRATE_FAIL</a>);</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Make inactive so setting can be modified</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, 0x10);</div><div class="line"></div><div class="line">   <span class="comment">// Set new offsets</span></div><div class="line">   int8_t correction[] = { <a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a250a6018734a53db228819569caa64c0">OFF_X</a>, (int8_t)Xout_Accel, (int8_t)Yout_Accel, (int8_t)Zout_Accel };</div><div class="line">   i2c.<a class="code" href="class_u_s_b_d_m_1_1_i2c.html#af617511a042b33c860d3beb7298a421c">transmit</a>(<a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a6364c3b10a4fb3483a52f5209033d0c6">DEVICE_ADDRESS</a>, <span class="keyword">sizeof</span>(correction), (uint8_t*)correction);</div><div class="line"></div><div class="line">   <span class="comment">// Restore original settings</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_m_m_a845x.html#a18d992639c965d0e5dd79b685f8c246a">writeReg</a>(<a class="code" href="mma845x_8cpp.html#a26e1124d33b4acdb532c49f6498df549a0e074f79acb56a4a8dcb4d3a373d4564">CTRL_REG1</a>, originalControlReg1Value);</div><div class="line">   <span class="keywordflow">return</span> <a name="a77"></a><a class="code" href="namespace_u_s_b_d_m.html#af5406ca776612b2687e916fb194ffd26a4ba45ce064022eb4eb90e52c3d48a83a">E_NO_ERROR</a>;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 31 2019 16:45:43 for Lab5_Section2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
