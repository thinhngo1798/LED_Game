<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab5_Section2: dma-spi-example.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab5_Section2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dma-spi-example_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">dma-spi-example.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> * @file    dma-spi-example.cpp (180.ARM_Peripherals/Snippets)</span></div><div class="line"><span class="comment"> * @brief   DMA example using SPI</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 10/1/2016</span></div><div class="line"><span class="comment"> *      Author: podonoghue</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> */</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * This example uses DMA to transfer data from a buffer to the SPI for transmission.</span></div><div class="line"><span class="comment"> * At the same time another DMA channel is used to transfer receive data from the SPI to a buffer.</span></div><div class="line"><span class="comment"> * The transmission is not continuous but may be restarted without setting up the TCD again:</span></div><div class="line"><span class="comment"> * - Clears the DREQ on transfer complete</span></div><div class="line"><span class="comment"> * - Arranging SLAST/DLAST to return the transfer addresses to starting value after each major-loop.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This example requires DMA and SPI interrupts.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * It is necessary to enable these in Configure.usbdmProject</span></div><div class="line"><span class="comment"> * under the &quot;Peripheral Parameters&quot;-&gt;DMA0 and &quot;Peripheral Parameters&quot;-&gt;SPI tabs</span></div><div class="line"><span class="comment"> * Select irqHandlingMethod option (Class Method - Software ...)</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hardware_8h.html">hardware.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dma_8h.html">dma.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="spi_8h.html">spi.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a>;</div><div class="line"></div><div class="line"><span class="comment">// Connection - change as required</span></div><div class="line"><span class="keyword">using</span> Led = <a name="_a0"></a><a class="code" href="class_u_s_b_d_m_1_1_gpio_c.html">GpioC&lt;3, ActiveLow&gt;</a>;  <span class="comment">// = PTA2 = D9 = Blue LED</span></div><div class="line"></div><div class="line"><span class="comment">// SPI to use</span></div><div class="line"><a name="_a1"></a><a class="code" href="class_u_s_b_d_m_1_1_spi0.html">Spi0</a> spi;</div><div class="line"></div><div class="line"><span class="comment">// Which SPI PCS signal to assert</span></div><div class="line"><span class="keyword">static</span> constexpr <a class="code" href="group___s_p_i___group.html#ga50f110a07879cc4b911afb6511b22812">SpiPeripheralSelect</a> spiSelect = <a name="a2"></a><a class="code" href="group___s_p_i___group.html#gga50f110a07879cc4b911afb6511b22812af4dc727884b173d537af983bd005e04a">SpiPeripheralSelect_2</a>;</div><div class="line"></div><div class="line"><span class="comment">// Used to indicate complete transfer</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> complete;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * DMA complete callback</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Sets flag to indicate sequence complete.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dmaCallback(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> channel) {</div><div class="line">   <a name="a3"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a9cabbf85d0da0a95d7b7e55f02daedc3">Dma0::clearInterruptRequest</a>(channel);</div><div class="line">   complete = <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Base value for transmit data</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> constexpr uint32_t PUSH_BASE =</div><div class="line">      <a name="a4"></a><a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gadc43fdbca4e34579e7ede4ac104c7ae5">SPI_PUSHR_CTAS</a>(0)|   <span class="comment">// CTAR 0</span></div><div class="line">      <a name="a5"></a><a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga91c3110a4dbb544395f48a657b22dabe">SPI_PUSHR_EOQ</a>(0)|    <span class="comment">// Not end of Queue</span></div><div class="line">      <a name="a6"></a><a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga4662cfbebbea26e0c427a9e4c310d9b2">SPI_PUSHR_CTCNT</a>(0)|  <span class="comment">// Don&#39;t clear transfer counter</span></div><div class="line">      spiSelect;           <span class="comment">// Peripheral to select</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Transmit Data + Control information.</span></div><div class="line"><span class="comment"> * Continuously asserts peripheral select during transfer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">const</span> uint32_t txBuffer[]= {</div><div class="line">      PUSH_BASE|<a name="a7"></a><a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a name="a8"></a><a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(1),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(2),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(3),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(4),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(5),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(6),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(7),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(8),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(9),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(10),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(11),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(12),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(1)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(13),</div><div class="line">      PUSH_BASE|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga7efcf8c8ad046b928c6aa218e9d63be7">SPI_PUSHR_CONT</a>(0)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#gad19c7faf45531d7c7a6703a54ac2f69d">SPI_PUSHR_TXDATA</a>(14)|<a class="code" href="group___s_p_i___register___masks___g_r_o_u_p.html#ga91c3110a4dbb544395f48a657b22dabe">SPI_PUSHR_EOQ</a>(1),</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint8_t rxBuffer[<span class="keyword">sizeof</span>(txBuffer)/<span class="keyword">sizeof</span>(txBuffer[0])];</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t rxTestBuffer[<span class="keyword">sizeof</span>(txBuffer)/<span class="keyword">sizeof</span>(txBuffer[0])] = {1,2,3,4,5,6,7,8,9,10,11,12,13,14};</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Configure DMA from Memory-to-SPI-to-Memory</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> initDma(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaTransmitChannel, <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaReceiveChannel) {</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * @verbatim</span></div><div class="line"><span class="comment">    * +------------------------------+            Simple DMA mode (MLNO = Minor Loop Mapping Disabled)</span></div><div class="line"><span class="comment">    * | Major Loop =                 |            ==================================================</span></div><div class="line"><span class="comment">    * |    CITER x Minor Loop        |</span></div><div class="line"><span class="comment">    * |                              |            Each DMA request triggers a minor-loop transfer sequence.</span></div><div class="line"><span class="comment">    * | +--------------------------+ |&lt;-DMA Req.  The minor loops are counted in the major-loop.</span></div><div class="line"><span class="comment">    * | | Minor Loop               | |</span></div><div class="line"><span class="comment">    * | | Each transfer            | |            The following are used during a minor loop:</span></div><div class="line"><span class="comment">    * | |   SADDR-&gt;DADDR           | |             - SADDR Source address</span></div><div class="line"><span class="comment">    * | |   SADDR += SOFF          | |             - SOFF  Adjustment applied to SADDR after each transfer</span></div><div class="line"><span class="comment">    * | |   DADDR += DOFF          | |             - DADDR Destination address</span></div><div class="line"><span class="comment">    * | | Total transfer is NBYTES | |             - DOFF  Adjustment applied to DADDR after each transfer</span></div><div class="line"><span class="comment">    * | +--------------------------+ |             - NBYTES Number of bytes to transfer</span></div><div class="line"><span class="comment">    * | +--------------------------+ |&lt;-DMA Req.   - Attributes</span></div><div class="line"><span class="comment">    * | | Minor Loop               | |               - ATTR_SSIZE, ATTR_DSIZE Source and destination transfer sizes</span></div><div class="line"><span class="comment">    * |..............................|               - ATTR_SMOD, ATTR_DMOD Modulo</span></div><div class="line"><span class="comment">    * | |                          | |</span></div><div class="line"><span class="comment">    * | +--------------------------+ |             The number of reads and writes done will depend on NBYTES, SSIZE and DSIZE</span></div><div class="line"><span class="comment">    * | +--------------------------+ |&lt;-DMA Req.   For example: NBYTES=12, SSIZE=16-bits, DSIZE=32-bits =&gt; 6 reads, 3 writes</span></div><div class="line"><span class="comment">    * | | Minor Loop               | |             NBYTES must be an even multiple of SSIZE and DSIZE in bytes.</span></div><div class="line"><span class="comment">    * | | Each transfer            | |</span></div><div class="line"><span class="comment">    * | |   SADDR-&gt;DADDR           | |            The following are used by the major loop</span></div><div class="line"><span class="comment">    * | |   SADDR += SOFF          | |             - SLAST Adjustment applied to SADDR at the end of each major loop</span></div><div class="line"><span class="comment">    * | |   DADDR += DOFF          | |             - DLAST Adjustment applied to DADDR at the end of each major loop</span></div><div class="line"><span class="comment">    * | | Total transfer is NBYTES | |             - CITER Major loop counter - counts how many completed major loops</span></div><div class="line"><span class="comment">    * | +--------------------------+ |</span></div><div class="line"><span class="comment">    * |                              |            SLAST and DLAST may be used to reset the addresses to the initial value or</span></div><div class="line"><span class="comment">    * | At end of Major Loop         |            link to the next transfer.</span></div><div class="line"><span class="comment">    * |    SADDR += SLAST            |            The total transferred for the entire sequence is CITER x NBYTES.</span></div><div class="line"><span class="comment">    * |    DADDR += DLAST            |</span></div><div class="line"><span class="comment">    * |                              |            Important options in the CSR:</span></div><div class="line"><span class="comment">    * | Total transfer =             |              - DMA_CSR_INTMAJOR = Generate interrupt at end of Major-loop</span></div><div class="line"><span class="comment">    * |    CITER*NBYTES              |              - DMA_CSR_DREQ     = Clear hardware request at end of Major-loop</span></div><div class="line"><span class="comment">    * +------------------------------+              - DMA_CSR_START    = Start transfer. Used for software transfers. Automatically cleared.</span></div><div class="line"><span class="comment">    * @endverbatim</span></div><div class="line"><span class="comment">    */</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Structure to define the Transmit DMA transfer</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * Note: This uses a 32-bit transfer even though the transmit data is only 8-bit</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> constexpr <a name="_a9"></a><a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> txTcd = <a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> (</div><div class="line">      <span class="comment">/* Source address                 */</span> (uint32_t)(txBuffer),           <span class="comment">// Source array</span></div><div class="line">      <span class="comment">/* Source offset                  */</span> <span class="keyword">sizeof</span>(txBuffer[0]),            <span class="comment">// Source address advances 1 element for each request</span></div><div class="line">      <span class="comment">/* Source size                    */</span> <a name="a10"></a><a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(txBuffer[0]),           <span class="comment">// 32-bit read from source address</span></div><div class="line">      <span class="comment">/* Source modulo                  */</span> <a name="a11"></a><a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,             <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Last source adjustment         */</span> -(<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(txBuffer),         <span class="comment">// Reset Source address to start of array on completion</span></div><div class="line"></div><div class="line">      <span class="comment">/* Destination address            */</span> spi.<a name="a12"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a3b36f24bd96e36757527ee4ec19d2072">spiPUSHR</a>(),                 <span class="comment">// Destination is SPI.PUSHR data register</span></div><div class="line">      <span class="comment">/* Destination offset             */</span> 0,                              <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line">      <span class="comment">/* Destination size               */</span> <a name="a13"></a><a class="code" href="group___d_m_a___group.html#ggabb8cbb145150ac91b85959281a1fbc39a1f6ac283a91ebf1f62447ec7a99c6a36">DmaSize_32bit</a>,                  <span class="comment">// 32-bit write to destination address</span></div><div class="line">      <span class="comment">/* Destination modulo             */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,             <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Last destination adjustment    */</span> 0,                              <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Minor loop byte count          */</span> <a name="a14"></a><a class="code" href="group___d_m_a___group.html#ga3ac933fd1a1b5eefd5e96a9eeebb71e3">dmaNBytes</a>(<span class="keyword">sizeof</span>(txBuffer[0])), <span class="comment">// Total transfer in one minor-loop</span></div><div class="line">      <span class="comment">/* Major loop count               */</span> <a name="a15"></a><a class="code" href="group___d_m_a___group.html#gac6e553966ce0ccdbb184d77317f48045">dmaCiter</a>((<span class="keyword">sizeof</span>(txBuffer))/    <span class="comment">// Transfer entire buffer</span></div><div class="line">      <span class="comment">/*                                */</span>           <span class="keyword">sizeof</span>(txBuffer[0])),</div><div class="line"></div><div class="line">      <span class="comment">/* Start channel                  */</span> <span class="keyword">false</span>,                          <span class="comment">// Don&#39;t start (triggered by hardware)</span></div><div class="line">      <span class="comment">/* Disable Req. on major complete */</span> <span class="keyword">true</span>,                           <span class="comment">// Clear hardware request when major loop completed</span></div><div class="line">      <span class="comment">/* Interrupt on major complete    */</span> <span class="keyword">false</span>,                          <span class="comment">// No interrupt</span></div><div class="line">      <span class="comment">/* Interrupt on half complete     */</span> <span class="keyword">false</span>,                          <span class="comment">// No interrupt</span></div><div class="line">      <span class="comment">/* Bandwidth (speed) Control      */</span> <a name="a16"></a><a class="code" href="group___d_m_a___group.html#ggaeb59b0776210eb819e37188e948348c6ab57167f9dc828222f9194199a4fb4178">DmaSpeed_NoStalls</a>               <span class="comment">// Full speed</span></div><div class="line">   );</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Structure to define the Receive DMA transfer</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * Note: The transfer size used here is 8-bits only</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> constexpr <a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> rxTcd (</div><div class="line">      <span class="comment">/* Source address                 */</span> spi.<a name="a17"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#adcf67c513eefacdf5158c48545a2f77d">spiPOPR</a>(),                  <span class="comment">// Source is SPI.POPR data register</span></div><div class="line">      <span class="comment">/* Source offset                  */</span> 0,                              <span class="comment">// Source address doesn&#39;t change</span></div><div class="line">      <span class="comment">/* Source size                    */</span> <a name="a18"></a><a class="code" href="group___d_m_a___group.html#ggabb8cbb145150ac91b85959281a1fbc39ab82a3c43de315e5b291735f25ac3095c">DmaSize_8bit</a>,                   <span class="comment">// 8-bit read from source address</span></div><div class="line">      <span class="comment">/* Source modulo                  */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,             <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Last source adjustment         */</span> 0,                              <span class="comment">// Source address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Destination address            */</span> (uint32_t)(rxBuffer),           <span class="comment">// Destination array</span></div><div class="line">      <span class="comment">/* Destination offset             */</span> <span class="keyword">sizeof</span>(rxBuffer[0]),            <span class="comment">// Destination address advances 1 element for each request</span></div><div class="line">      <span class="comment">/* Destination size               */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(rxBuffer[0]),           <span class="comment">// 8-bit write to Destination address</span></div><div class="line">      <span class="comment">/* Destination modulo             */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,             <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Last destination adjustment    */</span> -(int)<span class="keyword">sizeof</span>(rxBuffer),         <span class="comment">// Reset destination address to start of array on completion</span></div><div class="line"></div><div class="line">      <span class="comment">/* Minor loop byte count          */</span> <a class="code" href="group___d_m_a___group.html#ga3ac933fd1a1b5eefd5e96a9eeebb71e3">dmaNBytes</a>(<span class="keyword">sizeof</span>(rxBuffer[0])), <span class="comment">// Total transfer in one minor-loop</span></div><div class="line">      <span class="comment">/* Major loop count               */</span> <a class="code" href="group___d_m_a___group.html#gac6e553966ce0ccdbb184d77317f48045">dmaCiter</a>(<span class="keyword">sizeof</span>(rxBuffer)/      <span class="comment">// Transfer entire buffer</span></div><div class="line">      <span class="comment">/*                                */</span>          <span class="keyword">sizeof</span>(rxBuffer[0])),</div><div class="line"></div><div class="line">      <span class="comment">/* Start channel                  */</span> <span class="keyword">false</span>,                          <span class="comment">// Don&#39;t start (triggered by hardware)</span></div><div class="line">      <span class="comment">/* Disable Req. on major complete */</span> <span class="keyword">true</span>,                           <span class="comment">// Clear hardware request when major loop completed</span></div><div class="line">      <span class="comment">/* Interrupt on major complete    */</span> <span class="keyword">true</span>,                           <span class="comment">// Generate interrupt on completion of major-loop</span></div><div class="line">      <span class="comment">/* Interrupt on half complete     */</span> <span class="keyword">false</span>,                          <span class="comment">// No interrupt</span></div><div class="line">      <span class="comment">/* Bandwidth (speed) Control      */</span> <a class="code" href="group___d_m_a___group.html#ggaeb59b0776210eb819e37188e948348c6ab57167f9dc828222f9194199a4fb4178">DmaSpeed_NoStalls</a>               <span class="comment">// Full speed</span></div><div class="line">   );</div><div class="line"></div><div class="line">   <span class="comment">// Sequence not complete yet</span></div><div class="line">   complete = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">   <span class="comment">// Enable DMAC with default settings</span></div><div class="line">   <a name="a19"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a9a1448e4443619ba45e7d28b36c24711">Dma0::configure</a>();</div><div class="line"></div><div class="line">   <span class="comment">// Set callback (Interrupts are enabled in TCD)</span></div><div class="line">   <a name="a20"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ac26b60d5e5132a384cfe047d79ef798a">Dma0::setCallback</a>(dmaTransmitChannel, dmaCallback);</div><div class="line">   <a name="a21"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#afa8f41553743a7e10bccdc40d6eaeb5a">Dma0::enableNvicInterrupts</a>(dmaTransmitChannel, <a name="a22"></a><a class="code" href="hardware_8h.html#a7c8f445c1595473f9c473c29c30f47c8a484f3c1e0f4b27d3327f8d8f2f820009">NvicPriority_Normal</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Set callback (Interrupts are enabled in TCD)</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ac26b60d5e5132a384cfe047d79ef798a">Dma0::setCallback</a>(dmaReceiveChannel, dmaCallback);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#afa8f41553743a7e10bccdc40d6eaeb5a">Dma0::enableNvicInterrupts</a>(dmaReceiveChannel, <a class="code" href="hardware_8h.html#a7c8f445c1595473f9c473c29c30f47c8a484f3c1e0f4b27d3327f8d8f2f820009">NvicPriority_Normal</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Connect DMA channel to SPI Tx</span></div><div class="line">   <a name="a23"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_mux___t.html#a16ec126a63c1258d96b7c83e9088a531">DmaMux0::configure</a>(dmaTransmitChannel, <a name="a24"></a><a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#gga5b50a0a241f752e58cb84650aaa39052ae002be136f21fdb5e3cc344273c45f24">Dma0Slot_SPI0_Tx</a>, <a name="a25"></a><a class="code" href="group___d_m_a___group.html#ggaf45af97259922f16e01ad5cbe09cfe4aa9d3eb30900f80b9368dfed376f6a5d9c">DmaMuxEnable_Continuous</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Connect DMA channel to SPI Rx</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_mux___t.html#a16ec126a63c1258d96b7c83e9088a531">DmaMux0::configure</a>(dmaReceiveChannel, <a name="a26"></a><a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#gga5b50a0a241f752e58cb84650aaa39052a8ceb5a65cd422e3f9bee69dddae0a154">Dma0Slot_SPI0_Rx</a>, <a class="code" href="group___d_m_a___group.html#ggaf45af97259922f16e01ad5cbe09cfe4aa9d3eb30900f80b9368dfed376f6a5d9c">DmaMuxEnable_Continuous</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Configure the Tx transfer</span></div><div class="line">   <a name="a27"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#af6d178f2b901c5edaebe6f2bf5086cce">Dma0::configureTransfer</a>(dmaTransmitChannel, txTcd);</div><div class="line"></div><div class="line">   <span class="comment">// Configure the Rx transfer</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#af6d178f2b901c5edaebe6f2bf5086cce">Dma0::configureTransfer</a>(dmaReceiveChannel, rxTcd);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * SPI callback</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Used for debug timing checks.</span></div><div class="line"><span class="comment"> * LED toggles on each SPI event</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param status Interrupt status value from SPI-&gt;SR</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> spiCallback(uint32_t status) {</div><div class="line">   (void)status;</div><div class="line">   Led::toggle();</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Configure SPI</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> configureSpi() {</div><div class="line">   spi.<a name="a28"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a8bc2f3f55b49dfccbe83b260dd5e6170">setSpeed</a>(24000000);</div><div class="line">   spi.<a name="a29"></a><a class="code" href="class_u_s_b_d_m_1_1_spi.html#a315e73cf01b1347e81a15a1754cfb3e7">setPeripheralSelect</a>(spiSelect, <a name="a30"></a><a class="code" href="group___peripheral_pin_tables.html#ggab1f3d9325270a2a7eead72ecb92f22aba61cd7e3448f9791f1ea770d518c7f738">ActiveLow</a>, <a name="a31"></a><a class="code" href="group___s_p_i___group.html#gga9f3668a7f409a8fdc92406d7662de333a8ec2fd3de2a45255424e9ac35d52dfbf">SpiSelectMode_Idle</a>);</div><div class="line">   spi.<a name="a32"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a40d74b6bdc0b6a276fc5512a72b84503">setCallback</a>(spiCallback);</div><div class="line">   spi.<a name="a33"></a><a class="code" href="class_u_s_b_d_m_1_1_spi.html#a4c0cef19acba73ee5de81110790ef1f3">configureInterrupts</a>(</div><div class="line">         <a name="a34"></a><a class="code" href="group___s_p_i___group.html#gga24da8a6a97bc07dfa541aa1ff123133ea78fe17a06fb7dae03e0646589cb9fd1f">SpiTxCompleteInterrupt_Enabled</a>,</div><div class="line">         <a name="a35"></a><a class="code" href="group___s_p_i___group.html#gga78518edc7052d91f8c4685f4827d0064a339888805da274374c54d221f06fa4cc">SpiEndOfQueueInterrupt_Enabled</a>,</div><div class="line">         <a name="a36"></a><a class="code" href="group___s_p_i___group.html#ggaa1b02c943327bca3733dae0586a26489a87cafbf6da5a8eebaa795e91d1cc6764">SpiFifoUnderflowInterrupt_Enabled</a>,</div><div class="line">         <a name="a37"></a><a class="code" href="group___s_p_i___group.html#ggad16f361d50392ae9c2b482346bff226da325d1ed2b180cb430d8564b5bdc621f1">SpiFifoOverflowInterrupt_Enabled</a>);</div><div class="line">   spi.<a name="a38"></a><a class="code" href="class_u_s_b_d_m_1_1_spi.html#aff44a226f7f5d54a680eab9c1cc026fc">configureFifoRequests</a>(<a name="a39"></a><a class="code" href="group___s_p_i___group.html#ggab9c61acefc026b506de46a7d251980c5a6473c0fd70acb526e269aada9cd7ba50">SpiFifoTxRequest_Dma</a>, <a name="a40"></a><a class="code" href="group___s_p_i___group.html#gga166d71a39a4435151adbcfd0776e5f42a4ad1fe42affd2d19652902fd16528904">SpiFifoRxRequest_Dma</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Start transfer</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> startTransfer(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaTransmitChannel, <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaReceiveChannel) {</div><div class="line">   complete = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">   spi.<a name="a41"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#aee108a9489486473556a57de24b755cb">getStatus</a>();</div><div class="line">   spi.<a name="a42"></a><a class="code" href="class_u_s_b_d_m_1_1_spi.html#a676b0b2122bae8364b0cf85396c256dc">enableTransfer</a>();</div><div class="line"></div><div class="line">   <span class="comment">// Enable Rx hardware requests</span></div><div class="line">   <a name="a43"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ad52210f7989479ed83e4824d6da69cef">Dma0::enableRequests</a>(dmaReceiveChannel);</div><div class="line"></div><div class="line">   <span class="comment">// Enable Tx hardware requests</span></div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ad52210f7989479ed83e4824d6da69cef">Dma0::enableRequests</a>(dmaTransmitChannel);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a44"></a><a class="code" href="mma845x-example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line">   <a name="a45"></a><a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a46"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Starting&quot;</span>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a name="a47"></a><a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiPtr      = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>((<span class="keywordtype">unsigned</span>)&amp;spi.<a name="a48"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a07ac342175c3e24e8b1c090ba60fcefc">spiPtr</a>(), <a name="a49"></a><a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiBase     = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a name="a50"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a57aab6c3d565a9332facdc21f03e866c">spiBase</a>(), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiCR       = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a name="a51"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a895e32e5c96e0d93a285296c09a930d8">spiCR</a>(), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiCTAR[1]  = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a name="a52"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#ad505b6af9adb77517adf275aeda9e618">spiCTAR</a>(1), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiMCR      = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a name="a53"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a4dea7d78ff082683dd65e5b2042c6b79">spiMCR</a>(), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiPOPR     = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#adcf67c513eefacdf5158c48545a2f77d">spiPOPR</a>(), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiPUSHR    = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a3b36f24bd96e36757527ee4ec19d2072">spiPUSHR</a>(), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;spiSR       = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(spi.<a name="a54"></a><a class="code" href="class_u_s_b_d_m_1_1_spi_base___t.html#a7b9d38c74fa4319027f459ef7b644d81">spiSR</a>(), <a class="code" href="group___f_o_r_m_a_t_t_e_d___i_o___group.html#gga5bcb09090881ebaf2d48a20117c298d4ab06e8923a49de6e9202ba827e95da7f7">Radix_16</a>);</div><div class="line"></div><div class="line">   Led::setOutput();</div><div class="line"></div><div class="line">   <span class="comment">// DMA channel number to use for transmission</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaTransmitChannel = <a name="a55"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a48be2c9ab4c7613402a34e8676484b6a">Dma0::allocatePeriodicChannel</a>();</div><div class="line">   <span class="keywordflow">if</span> (dmaTransmitChannel == <a name="a56"></a><a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19aba1b991e9afaf9f9455ffe9ff7b8a92d">DmaChannelNum_None</a>) {</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Failed to allocate Transmit DMA channel&quot;</span>);</div><div class="line">      <a name="a57"></a><a class="code" href="namespace_u_s_b_d_m.html#ab59696ecaf96d6ee79249ea003869d7a">checkError</a>();</div><div class="line">   }</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Allocated Transmit DMA channel  #&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(dmaTransmitChannel);</div><div class="line"></div><div class="line">   <span class="comment">// DMA channel number to use for reception</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaReceiveChannel = <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a48be2c9ab4c7613402a34e8676484b6a">Dma0::allocatePeriodicChannel</a>();</div><div class="line">   <span class="keywordflow">if</span> (dmaReceiveChannel == <a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19aba1b991e9afaf9f9455ffe9ff7b8a92d">DmaChannelNum_None</a>) {</div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(<span class="stringliteral">&quot;Failed to allocate Receive DMA channel&quot;</span>);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ab59696ecaf96d6ee79249ea003869d7a">checkError</a>();</div><div class="line">   }</div><div class="line">   <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Allocated Receive DMA channel  #&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(dmaReceiveChannel);</div><div class="line"></div><div class="line">   <span class="comment">// Set up DMA transfer from memory -&gt; SPI -&gt; memory</span></div><div class="line">   initDma(dmaTransmitChannel, dmaReceiveChannel);</div><div class="line">   configureSpi();</div><div class="line"></div><div class="line">   <span class="keywordtype">unsigned</span> failureCount = 0;</div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      <span class="comment">// Clear Rx buffer</span></div><div class="line">      memset(rxBuffer, 0, <span class="keyword">sizeof</span>(rxBuffer));</div><div class="line"></div><div class="line">      <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Starting Transfer,&quot;</span>);</div><div class="line"></div><div class="line">      <span class="comment">// Start transfer</span></div><div class="line">      startTransfer(dmaTransmitChannel, dmaReceiveChannel);</div><div class="line"></div><div class="line">      <span class="comment">// Wait for completion of 1 Major-loop = 1 txBuffer</span></div><div class="line">      <span class="keywordflow">while</span> (!complete) {</div><div class="line">         __asm__(<span class="stringliteral">&quot;nop&quot;</span>);</div><div class="line">      }</div><div class="line">      <span class="comment">// Check expected Rx data</span></div><div class="line">      <span class="keywordflow">if</span> (memcmp(rxBuffer, rxTestBuffer, <span class="keyword">sizeof</span>(rxBuffer)) != 0) {</div><div class="line">         failureCount++;</div><div class="line">         <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Failed   - fail count = &quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(failureCount);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> {</div><div class="line">         <a class="code" href="group___c_o_n_s_o_l_e___group.html#ga7ab1ae5607fc5d9c172baec4df3d39e2">console</a>.<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a4379e10167a471cccd90826d239c7a7e">write</a>(<span class="stringliteral">&quot;Verified - fail count =&quot;</span>).<a class="code" href="class_u_s_b_d_m_1_1_formatted_i_o.html#a42b3d46b9d0a086e5c0ea157c9c2aaaa">writeln</a>(failureCount);</div><div class="line">      }</div><div class="line">   }</div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 31 2019 16:45:42 for Lab5_Section2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
