<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab5_Section2: neopixel-example.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab5_Section2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('neopixel-example_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">neopixel-example.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * ============================================================================</span></div><div class="line"><span class="comment"> * @file    neopixel-example.cpp (180.ARM_Peripherals/Snippets)</span></div><div class="line"><span class="comment"> * @brief   Demo using Ftm class to implement a basic driver for a neopixel</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The number of lines of neopixels that can be driven is limited by the</span></div><div class="line"><span class="comment"> * number of port pins available on a single port.</span></div><div class="line"><span class="comment"> * The code assumes consecutive pins within a byte as it uses a GpioXField</span></div><div class="line"><span class="comment"> * and byte size data but this limitation can be removed.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This code is loosely based on the the technique described here:</span></div><div class="line"><span class="comment"> * https://mcuoneclipse.com/2015/08/01/tutorial-adafruit-ws2812b-neopixels-with-the-freescale-frdm-k64f-board-part-1-hardware/</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 3/10/2018</span></div><div class="line"><span class="comment"> *      Author: podonoghue</span></div><div class="line"><span class="comment"> * ============================================================================</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hardware_8h.html">hardware.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dma_8h.html">dma.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="smc_8h.html">smc.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a>;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * This example uses DMA interrupts.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * It is necessary to enable these in Configure.usbdmProject</span></div><div class="line"><span class="comment"> * under the &quot;Peripheral Parameters&quot;-&gt;DMA0 tab.</span></div><div class="line"><span class="comment"> * Select irqHandlingMethod option (Class Method - Software ...)</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** GPIO driving pixel data */</span></div><div class="line"><span class="keyword">using</span> Pixel = <a name="_a0"></a><a class="code" href="class_u_s_b_d_m_1_1_gpio_d_field.html">GpioDField&lt;3,2&gt;</a>;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * FTM Timer being used - change as required</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">using</span> <a name="_a1"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html">Timer</a> = <a name="_a2"></a><a class="code" href="class_u_s_b_d_m_1_1_ftm0.html">Ftm0</a>;</div><div class="line"></div><div class="line"><span class="comment">// Fixed Timer channels.</span></div><div class="line"><span class="comment">// These are used to trigger DMA transfers to the PORT registers.</span></div><div class="line"><span class="keyword">using</span> TimerSetChannel   = <a name="_a3"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t_1_1_channel.html">Timer::Channel&lt;1&gt;</a>; <span class="comment">//!&lt; PSOR - Sets pin high</span></div><div class="line"><span class="comment"></span><span class="keyword">using</span> TimerDataChannel  = <a class="code" href="class_u_s_b_d_m_1_1_pit_base___t_1_1_channel.html">Timer::Channel&lt;2&gt;</a>; <span class="comment">//!&lt; PCOR - Sets pin low/unchanged according to data</span></div><div class="line"><span class="comment"></span><span class="keyword">using</span> TimerClearChannel = <a class="code" href="class_u_s_b_d_m_1_1_pit_base___t_1_1_channel.html">Timer::Channel&lt;3&gt;</a>; <span class="comment">//!&lt; PCOR - Sets pin low</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// These must match the above channels</span></div><div class="line">constexpr <a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#ga5b50a0a241f752e58cb84650aaa39052">DmaSlot</a> TimerSetChannel_dmaSlot   = <a name="a4"></a><a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#gga5b50a0a241f752e58cb84650aaa39052af34737a17c2b8e7034e33f81c9f8d443">Dma0Slot_FTM0_Ch1</a>;</div><div class="line">constexpr <a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#ga5b50a0a241f752e58cb84650aaa39052">DmaSlot</a> TimerDataChannel_dmaSlot  = <a name="a5"></a><a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#gga5b50a0a241f752e58cb84650aaa39052adaeb62663c55555dccd7fad7cb95f41d">Dma0Slot_FTM0_Ch2</a>;</div><div class="line">constexpr <a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#ga5b50a0a241f752e58cb84650aaa39052">DmaSlot</a> TimerClearChannel_dmaSlot = <a name="a6"></a><a class="code" href="group___d_m_a_m_u_x___peripheral__access__layer___g_r_o_u_p.html#gga5b50a0a241f752e58cb84650aaa39052a155576aee287b6a4c24d7b2d1ecd106f">Dma0Slot_FTM0_Ch3</a>;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** Used to indicate transfer has completed */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> complete;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * DMA complete callback.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Sets flag to indicate sequence complete.\n</span></div><div class="line"><span class="comment"> * Disables timer channels.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dmaCallback(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> channel) {</div><div class="line">   <a name="a7"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a9cabbf85d0da0a95d7b7e55f02daedc3">Dma0::clearInterruptRequest</a>(channel);</div><div class="line">   TimerSetChannel::configure(<a name="a8"></a><a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28a39aff282cbb0000d9f68fb882663abee">FtmChMode_Disabled</a>);</div><div class="line">   TimerDataChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28a39aff282cbb0000d9f68fb882663abee">FtmChMode_Disabled</a>);</div><div class="line">   TimerClearChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28a39aff282cbb0000d9f68fb882663abee">FtmChMode_Disabled</a>);</div><div class="line">   complete = <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** Number of pixels in a string. */</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">unsigned</span> PIXEL_LENGTH = 12;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** Number of RGB bits required per pixel. */</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">unsigned</span> PIXEL_BIT_LENGTH = 24;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Transmit Data (used with TimerData DMA channel)</span></div><div class="line"><span class="comment"> * This holds the unpacked pixel RGB information.\n</span></div><div class="line"><span class="comment"> * Each bit in an element represents a different pixel string.</span></div><div class="line"><span class="comment"> * For consistent DMA latency this must be allocated in same region as pixelBitmask.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> uint8_t pixelBuffer[PIXEL_LENGTH*PIXEL_BIT_LENGTH] = {0};</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Mask for GPIO pins (used with TimerData DMA channel)</span></div><div class="line"><span class="comment"> * For consistent DMA latency this must be allocated in same region as pixelBuffer.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> uint8_t pixelBitmask = Pixel::MASK;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Unpack RGB pixel data into format for transmission.</span></div><div class="line"><span class="comment"> * This routine would be called once for each pixel string being driven by</span></div><div class="line"><span class="comment"> * the GPIO pins.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] pixelMask  Bit mask for the GPIO pin driving the pixel string.</span></div><div class="line"><span class="comment"> * @param[in] pixelData  Array of RGB data for pixels in string.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> unpackPixels(uint8_t pixelMask, <span class="keyword">const</span> uint32_t pixelData[PIXEL_LENGTH]) {</div><div class="line">   uint8_t *pixelBufferPtr = pixelBuffer;</div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> pixel=0; pixel&lt;PIXEL_LENGTH; pixel++) {</div><div class="line">      uint32_t data = pixelData[pixel];</div><div class="line"></div><div class="line">      <span class="comment">// Shuffle data RGB =&gt; GRB</span></div><div class="line">      data = ((data&lt;&lt;8)&amp;0xFF0000)|((data&gt;&gt;8)&amp;0x00FF00)|(data&amp;0xFF);</div><div class="line"></div><div class="line">      <span class="comment">// Merge into transmission format - 1 bit per byte</span></div><div class="line">      <span class="comment">// GGGGGGGGRRRRRRRRBBBBBBBB =&gt; bit order in bytes</span></div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> bitMask=(1&lt;&lt;(PIXEL_BIT_LENGTH-1)); bitMask != 0; bitMask&gt;&gt;=1) {</div><div class="line">         <span class="keywordflow">if</span> (data &amp; bitMask) {</div><div class="line">            *pixelBufferPtr++ &amp;= ~pixelMask;</div><div class="line">         }</div><div class="line">         <span class="keywordflow">else</span> {</div><div class="line">            *pixelBufferPtr++ |= pixelMask;</div><div class="line">         }</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Configure DMA from pixelBuffer--&gt;GPIO.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This sets up three DMA channels:</span></div><div class="line"><span class="comment"> *  - Fixed Bit-mask -&gt; GPIO.PSOR Set all used bits</span></div><div class="line"><span class="comment"> *  - pixelBuffer    -&gt; GPIO.PCOR Selectively clear bits</span></div><div class="line"><span class="comment"> *  - Fixed Bit-mask -&gt; GPIO.PCOR Clear all used bits</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> initialiseDma(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaSetChannel, <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaDataChannel, <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaClearChannel) {</div><div class="line"></div><div class="line">   <span class="comment">// This example assumes the Pixels lie within the 1st byte of the port</span></div><div class="line">   static_assert((Pixel::MASK&amp;~0xFF) == 0);</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * @verbatim</span></div><div class="line"><span class="comment">    * +------------------------------+            Simple DMA mode (MLNO = Minor Loop Mapping Disabled)</span></div><div class="line"><span class="comment">    * | Major Loop =                 |            ==================================================</span></div><div class="line"><span class="comment">    * |    CITER x Minor Loop        |</span></div><div class="line"><span class="comment">    * |                              |            Each DMA request triggers a minor-loop transfer sequence.</span></div><div class="line"><span class="comment">    * | +--------------------------+ |&lt;-DMA Req.  The minor loops are counted in the major-loop.</span></div><div class="line"><span class="comment">    * | | Minor Loop               | |</span></div><div class="line"><span class="comment">    * | | Each transfer            | |            The following are used during a minor loop:</span></div><div class="line"><span class="comment">    * | |   SADDR-&gt;DADDR           | |             - SADDR Source address</span></div><div class="line"><span class="comment">    * | |   SADDR += SOFF          | |             - SOFF  Adjustment applied to SADDR after each transfer</span></div><div class="line"><span class="comment">    * | |   DADDR += DOFF          | |             - DADDR Destination address</span></div><div class="line"><span class="comment">    * | | Total transfer is NBYTES | |             - DOFF  Adjustment applied to DADDR after each transfer</span></div><div class="line"><span class="comment">    * | +--------------------------+ |             - NBYTES Number of bytes to transfer</span></div><div class="line"><span class="comment">    * | +--------------------------+ |&lt;-DMA Req.   - Attributes</span></div><div class="line"><span class="comment">    * | | Minor Loop               | |               - ATTR_SSIZE, ATTR_DSIZE Source and destination transfer sizes</span></div><div class="line"><span class="comment">    * |..............................|               - ATTR_SMOD, ATTR_DMOD Modulo of the transfer</span></div><div class="line"><span class="comment">    * | |                          | |</span></div><div class="line"><span class="comment">    * | +--------------------------+ |             The number of reads and writes done will depend on NBYTES, SSIZE and DSIZE</span></div><div class="line"><span class="comment">    * | +--------------------------+ |&lt;-DMA Req.   For example: NBYTES=12, SSIZE=16-bits, DSIZE=32-bits =&gt; 6 reads, 3 writes</span></div><div class="line"><span class="comment">    * | | Minor Loop               | |             NBYTES must be an even multiple of SSIZE and DSIZE in bytes.</span></div><div class="line"><span class="comment">    * | | Each transfer            | |</span></div><div class="line"><span class="comment">    * | |   SADDR-&gt;DADDR           | |            The following are used by the major loop</span></div><div class="line"><span class="comment">    * | |   SADDR += SOFF          | |             - SLAST Adjustment applied to SADDR after major loop</span></div><div class="line"><span class="comment">    * | |   DADDR += DOFF          | |             - DLAST Adjustment applied to DADDR after major loop</span></div><div class="line"><span class="comment">    * | | Total transfer is NBYTES | |             - CITER Major loop counter - counts how many minor loops</span></div><div class="line"><span class="comment">    * | +--------------------------+ |</span></div><div class="line"><span class="comment">    * |                              |            SLAST and DLAST may be used to reset the addresses to the initial value or</span></div><div class="line"><span class="comment">    * | At end of Major Loop         |            link to the next transfer.</span></div><div class="line"><span class="comment">    * |    SADDR += SLAST            |            The total transferred for the entire sequence is CITER x NBYTES.</span></div><div class="line"><span class="comment">    * |    DADDR += DLAST            |</span></div><div class="line"><span class="comment">    * |                              |            Important options in the CSR:</span></div><div class="line"><span class="comment">    * | Total transfer =             |              - DMA_CSR_INTMAJOR = Generate interrupt at end of Major-loop</span></div><div class="line"><span class="comment">    * |    CITER*NBYTES              |              - DMA_CSR_DREQ     = Clear hardware request at end of Major-loop</span></div><div class="line"><span class="comment">    * +------------------------------+              - DMA_CSR_START    = Start transfer. Used for software transfers. Automatically cleared.</span></div><div class="line"><span class="comment">    * @endverbatim</span></div><div class="line"><span class="comment">    */</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Structure to define the Pin setting DMA transfer.</span></div><div class="line"><span class="comment">    * Fixed bit-mask =&gt; PSOR.</span></div><div class="line"><span class="comment">    * Sets all pins driving strings of pixels.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> constexpr <a name="_a9"></a><a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> setTCD (</div><div class="line">      <span class="comment">/* Source address              */</span> (uint32_t)(&amp;pixelBitmask),         <span class="comment">// Source = Fixed bit-mask</span></div><div class="line">      <span class="comment">/* Source address offset       */</span> 0,                                 <span class="comment">// Source address doesn&#39;t advance</span></div><div class="line">      <span class="comment">/* Source size                 */</span> <a name="a10"></a><a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(pixelBitmask),             <span class="comment">// 8-bit read from Destination address</span></div><div class="line">      <span class="comment">/* Source address modulo       */</span> <a name="a11"></a><a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,                <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Source last adjustment      */</span> 0,                                 <span class="comment">// Source address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Destination address         */</span> Pixel::gpioPSOR(),                 <span class="comment">// Destination is GPIO.PSOR register</span></div><div class="line">      <span class="comment">/* Destination address offset  */</span> 0,                                 <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line">      <span class="comment">/* Destination size            */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(pixelBitmask),             <span class="comment">// 8-bit write to Source address</span></div><div class="line">      <span class="comment">/* Destination address modulo  */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,                <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Destination last adjustment */</span> 0,                                 <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Minor loop byte count       */</span> <span class="keyword">sizeof</span>(pixelBitmask),              <span class="comment">// Total transfer in one minor-loop</span></div><div class="line"></div><div class="line">      <span class="comment">/* Major loop count            */</span> <a name="a12"></a><a class="code" href="group___d_m_a___group.html#gac6e553966ce0ccdbb184d77317f48045">dmaCiter</a>(<span class="keyword">sizeof</span>(pixelBuffer))/</div><div class="line">      <span class="comment">/*                             */</span>          <span class="keyword">sizeof</span>(pixelBuffer[0]),   <span class="comment">// Transfer count matches entire pixelBuffer</span></div><div class="line"></div><div class="line">      <span class="comment">/* Channel Start               */</span> <span class="keyword">false</span>,                             <span class="comment">// Don&#39;t start (triggered by hardware)</span></div><div class="line">      <span class="comment">/* Disable Request             */</span> <span class="keyword">true</span>,                              <span class="comment">// Clear hardware request when complete major loop</span></div><div class="line">      <span class="comment">/* Interrupt on major complete */</span> <span class="keyword">false</span>,                             <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Interrupt on half complete  */</span> <span class="keyword">false</span>,                             <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Bandwidth (speed) Control   */</span> <a name="a13"></a><a class="code" href="group___d_m_a___group.html#ggaeb59b0776210eb819e37188e948348c6ab57167f9dc828222f9194199a4fb4178">DmaSpeed_NoStalls</a>                  <span class="comment">// Full speed</span></div><div class="line">   );</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Structure to define the Pin data DMA transfer</span></div><div class="line"><span class="comment">    * pixelBuffer[n] =&gt; PCOR</span></div><div class="line"><span class="comment">    * This selectively clears pins driving strings of pixels.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> constexpr <a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> dataTCD (</div><div class="line">      <span class="comment">/* Source address              */</span> (uint32_t)(pixelBuffer),           <span class="comment">// Source = Pixel data</span></div><div class="line">      <span class="comment">/* Source address offset       */</span> <span class="keyword">sizeof</span>(pixelBuffer[0]),            <span class="comment">// Source address advances</span></div><div class="line">      <span class="comment">/* Source size                 */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(pixelBuffer[0]),           <span class="comment">// 8-bit read from Destination address</span></div><div class="line">      <span class="comment">/* Source address modulo       */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,                <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Source last adjustment      */</span> -(<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(pixelBuffer),         <span class="comment">// Reset Source address back to start of buffer</span></div><div class="line"></div><div class="line">      <span class="comment">/* Destination address         */</span> Pixel::gpioPCOR(),                 <span class="comment">// Destination is GPIO.PCOR register</span></div><div class="line">      <span class="comment">/* Destination address offset  */</span> 0,                                 <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line">      <span class="comment">/* Destination size            */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(pixelBuffer[0]),           <span class="comment">// 8-bit write to Source address</span></div><div class="line">      <span class="comment">/* Destination address modulo  */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,                <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Destination last adjustment */</span> 0,                                 <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Minor loop byte count       */</span> <span class="keyword">sizeof</span>(pixelBuffer[0]),            <span class="comment">// Total transfer in one minor-loop</span></div><div class="line"></div><div class="line">      <span class="comment">/* Major loop count            */</span> <a class="code" href="group___d_m_a___group.html#gac6e553966ce0ccdbb184d77317f48045">dmaCiter</a>(<span class="keyword">sizeof</span>(pixelBuffer))/</div><div class="line">      <span class="comment">/*                             */</span>          <span class="keyword">sizeof</span>(pixelBuffer[0]),   <span class="comment">// Transfer count matches entire pixelBuffer</span></div><div class="line"></div><div class="line">      <span class="comment">/* Channel Start               */</span> <span class="keyword">false</span>,                             <span class="comment">// Don&#39;t start (triggered by hardware)</span></div><div class="line">      <span class="comment">/* Disable Request             */</span> <span class="keyword">true</span>,                              <span class="comment">// Clear hardware request when complete major loop</span></div><div class="line">      <span class="comment">/* Interrupt on major complete */</span> <span class="keyword">false</span>,                             <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Interrupt on half complete  */</span> <span class="keyword">false</span>,                             <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Bandwidth (speed) Control   */</span> <a class="code" href="group___d_m_a___group.html#ggaeb59b0776210eb819e37188e948348c6ab57167f9dc828222f9194199a4fb4178">DmaSpeed_NoStalls</a>                  <span class="comment">// Full speed</span></div><div class="line">   );</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Structure to define the Pin clearing DMA transfer</span></div><div class="line"><span class="comment">    * Fixed bit-mask =&gt; PCOR.</span></div><div class="line"><span class="comment">    * Clears all pins driving strings of pixels.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> constexpr <a class="code" href="struct_u_s_b_d_m_1_1_dma_tcd.html">DmaTcd</a> clearTCD (</div><div class="line">      <span class="comment">/* Source address              */</span> (uint32_t)(&amp;pixelBitmask),          <span class="comment">// Source = Fixed bit-mask</span></div><div class="line">      <span class="comment">/* Source address offset       */</span> 0,                                  <span class="comment">// Source address doesn&#39;t advance</span></div><div class="line">      <span class="comment">/* Source size                 */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(pixelBitmask),              <span class="comment">// 8-bit read from Destination address</span></div><div class="line">      <span class="comment">/* Source address modulo       */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,                 <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Source last adjustment      */</span> 0,                                  <span class="comment">// Source address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Destination address         */</span> Pixel::gpioPCOR(),                  <span class="comment">// Destination is GPIO.PCOR register</span></div><div class="line">      <span class="comment">/* Destination address offset  */</span> 0,                                  <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line">      <span class="comment">/* Destination size            */</span> <a class="code" href="group___d_m_a___group.html#ga472209fb90577a83007c34b5b9e8327f">dmaSize</a>(pixelBitmask),                   <span class="comment">// 8-bit write to Source address</span></div><div class="line">      <span class="comment">/* Destination address modulo  */</span> <a class="code" href="group___d_m_a___group.html#ggad76ee51269c8a14195ba0b4d314a0ff3a1fc343a376dd2dabcf1ae30d35a9d927">DmaModulo_Disabled</a>,                 <span class="comment">// No modulo</span></div><div class="line">      <span class="comment">/* Destination last adjustment */</span> 0,                                  <span class="comment">// Destination address doesn&#39;t change</span></div><div class="line"></div><div class="line">      <span class="comment">/* Minor loop byte count       */</span> <span class="keyword">sizeof</span>(pixelBitmask),               <span class="comment">// Total transfer in one minor-loop</span></div><div class="line"></div><div class="line">      <span class="comment">/* Major loop count            */</span> <a class="code" href="group___d_m_a___group.html#gac6e553966ce0ccdbb184d77317f48045">dmaCiter</a>(<span class="keyword">sizeof</span>(pixelBuffer))/</div><div class="line">      <span class="comment">/*                             */</span>          <span class="keyword">sizeof</span>(pixelBuffer[0]),    <span class="comment">// Transfer count matches entire pixelBuffer</span></div><div class="line"></div><div class="line">      <span class="comment">/* Channel Start               */</span> <span class="keyword">false</span>,                              <span class="comment">// Don&#39;t start (triggered by hardware)</span></div><div class="line">      <span class="comment">/* Disable Request             */</span> <span class="keyword">true</span>,                               <span class="comment">// Clear hardware request when complete major loop</span></div><div class="line">      <span class="comment">/* Interrupt on major complete */</span> <span class="keyword">true</span>,                               <span class="comment">// Generate interrupt on completion of Major-loop</span></div><div class="line">      <span class="comment">/* Interrupt on half complete  */</span> <span class="keyword">false</span>,                              <span class="comment">// Disabled</span></div><div class="line">      <span class="comment">/* Bandwidth (speed) Control   */</span> <a class="code" href="group___d_m_a___group.html#ggaeb59b0776210eb819e37188e948348c6ab57167f9dc828222f9194199a4fb4178">DmaSpeed_NoStalls</a>                   <span class="comment">// Full speed</span></div><div class="line">   );</div><div class="line"></div><div class="line">   <span class="comment">// Enable DMAC with default settings</span></div><div class="line">   <a name="a14"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a9a1448e4443619ba45e7d28b36c24711">Dma0::configure</a>(</div><div class="line">         <a name="a15"></a><a class="code" href="group___d_m_a___group.html#ggaad8ebd716832392d090e3d98a811043dafcd0c5aa8e319fabb871b8cf337edd3a">DmaOnError_Halt</a>,</div><div class="line">         <a name="a16"></a><a class="code" href="group___d_m_a___group.html#gga1e32105c1992aa7566e1c86aab3199a3acabf796f11b061ad3626e13a0fce5542">DmaMinorLoopMapping_Disabled</a>,</div><div class="line">         <a name="a17"></a><a class="code" href="group___d_m_a___group.html#gga0d95df55def92de5ef69629c371fe2f4a462e21c56655b2dfdc3e2a7370dbc021">DmaContinuousLink_Disabled</a>,</div><div class="line">         <a name="a18"></a><a class="code" href="group___d_m_a___group.html#ggacb2afe357b15d2f1534fab5ef2f87819acfd88890870ea457c094a0da516df564">DmaArbitration_RoundRobin</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Set callback (Interrupts are enabled in one TCD above)</span></div><div class="line">   <a name="a19"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#ac26b60d5e5132a384cfe047d79ef798a">Dma0::setCallback</a>(dmaClearChannel, dmaCallback);</div><div class="line">   <a name="a20"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#afa8f41553743a7e10bccdc40d6eaeb5a">Dma0::enableNvicInterrupts</a>(dmaClearChannel, <a name="a21"></a><a class="code" href="hardware_8h.html#a7c8f445c1595473f9c473c29c30f47c8a484f3c1e0f4b27d3327f8d8f2f820009">NvicPriority_Normal</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Connect DMA channels to FTM for triggering</span></div><div class="line">   <a name="a22"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_mux___t.html#a16ec126a63c1258d96b7c83e9088a531">DmaMux0::configure</a>(dmaSetChannel,   TimerSetChannel_dmaSlot,   <a name="a23"></a><a class="code" href="group___d_m_a___group.html#ggaf45af97259922f16e01ad5cbe09cfe4aa9d3eb30900f80b9368dfed376f6a5d9c">DmaMuxEnable_Continuous</a>);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_mux___t.html#a16ec126a63c1258d96b7c83e9088a531">DmaMux0::configure</a>(dmaDataChannel,  TimerDataChannel_dmaSlot,  <a class="code" href="group___d_m_a___group.html#ggaf45af97259922f16e01ad5cbe09cfe4aa9d3eb30900f80b9368dfed376f6a5d9c">DmaMuxEnable_Continuous</a>);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_mux___t.html#a16ec126a63c1258d96b7c83e9088a531">DmaMux0::configure</a>(dmaClearChannel, TimerClearChannel_dmaSlot, <a class="code" href="group___d_m_a___group.html#ggaf45af97259922f16e01ad5cbe09cfe4aa9d3eb30900f80b9368dfed376f6a5d9c">DmaMuxEnable_Continuous</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Configure the DMA transfers</span></div><div class="line">   <a name="a24"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#af6d178f2b901c5edaebe6f2bf5086cce">Dma0::configureTransfer</a>(dmaSetChannel,   setTCD);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#af6d178f2b901c5edaebe6f2bf5086cce">Dma0::configureTransfer</a>(dmaDataChannel,  dataTCD);</div><div class="line">   <a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#af6d178f2b901c5edaebe6f2bf5086cce">Dma0::configureTransfer</a>(dmaClearChannel, clearTCD);</div><div class="line"></div><div class="line">   <span class="comment">// Check if configuration failed</span></div><div class="line">   <a name="a25"></a><a class="code" href="namespace_u_s_b_d_m.html#ab59696ecaf96d6ee79249ea003869d7a">checkError</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * FTM/DMA   Set       Clear/None     Clear</span></div><div class="line"><span class="comment"> * Channels  (1)          (2)          (3)</span></div><div class="line"><span class="comment"> *            |            |            |</span></div><div class="line"><span class="comment"> *            V            V            V</span></div><div class="line"><span class="comment"> *            .            .            .</span></div><div class="line"><span class="comment"> *            +------------+            .            +--</span></div><div class="line"><span class="comment"> *    0 =&gt;    |  T0_HIGH   |            .  T0_LOW    |</span></div><div class="line"><span class="comment"> *          --+            +-------------------------+</span></div><div class="line"><span class="comment"> *            .                         .</span></div><div class="line"><span class="comment"> *            +-------------------------+            +--</span></div><div class="line"><span class="comment"> *    1 =&gt;    |       T1_HIGH           |  T1_LOW    |</span></div><div class="line"><span class="comment"> *          --+                         +------------+</span></div><div class="line"><span class="comment"> *            |&lt;-------------- Period --------------&gt;|</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//#define WS2812</span></div><div class="line"><span class="comment">//#define WS2812B</span></div><div class="line"><span class="preprocessor">#define SK6812</span></div><div class="line"><span class="preprocessor">#if defined WS2812</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> T0_HIGH = 400*<a name="a26"></a><a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;   <span class="comment">// 350 +/- 150 ns</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> T1_HIGH = 600*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;   <span class="comment">// 700 +/- 150 ns</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> PERIOD  = 1200*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;</div><div class="line"><span class="comment">//static constexpr float T0_LOW  = 800*ns; // 800 +/- 150 ns</span></div><div class="line"><span class="comment">//static constexpr float T1_LOW  = 600*ns; // 600 +/- 150 ns</span></div><div class="line"><span class="preprocessor">#elif defined WS2812B</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> T0_HIGH = 500*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;   <span class="comment">// 400 +/- 150 ns</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> T1_HIGH = 800*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;   <span class="comment">// 800 +/- 150 ns</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> PERIOD  = 1350*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;</div><div class="line"><span class="comment">//static constexpr float T0_LOW  = 850*ns; // 850 +/- 150 ns</span></div><div class="line"><span class="comment">//static constexpr float T1_LOW  = 550*ns; // 450 +/- 150 ns</span></div><div class="line"><span class="preprocessor">#elif defined SK6812</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> T0_HIGH = 300*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>+20*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>; <span class="comment">// 300 +/- 150 ns (20ns tweak for latency)</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> T1_HIGH = 600*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;       <span class="comment">// 600 +/- 150 ns</span></div><div class="line"><span class="keyword">static</span> constexpr <span class="keywordtype">float</span> PERIOD  = 1200*<a class="code" href="namespace_u_s_b_d_m.html#af5e3be27540ed3fde1d030bb8a682024">ns</a>;</div><div class="line"><span class="comment">//static constexpr float T0_LOW  = 900*ns;     // 900 +/- 150 ns</span></div><div class="line"><span class="comment">//static constexpr float T1_LOW  = 600*ns;     // 600 +/- 150 ns</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">#error &quot;Unknown Neopixel type&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Start DMA transfer of pixel data to LEDs.</span></div><div class="line"><span class="comment"> * Assumes initialiseFtm() and initialiseDma() have been called previously.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> startTransfer(<a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaSetChannel, <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaDataChannel, <a class="code" href="group___d_m_a___group.html#ga0801cb7745e0122855939ce6fabbef19">DmaChannelNum</a> dmaClearChannel) {</div><div class="line">   <span class="comment">// Sequence not complete yet</span></div><div class="line">   complete = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">   <span class="keyword">const</span> uint32_t dmaChannelMask = (1&lt;&lt;dmaSetChannel)|(1&lt;&lt;dmaDataChannel)|(1&lt;&lt;dmaClearChannel);</div><div class="line">   <span class="keyword">const</span> uint32_t ftmChannelMask = TimerSetChannel::CHANNEL_MASK|TimerDataChannel::CHANNEL_MASK|TimerClearChannel::CHANNEL_MASK;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * It is important that the FTM and DMA start in the correct sequence.</span></div><div class="line"><span class="comment">    * Due to the short timing involved it is easier to disable the timer</span></div><div class="line"><span class="comment">    * counter clock before making changes to FTM or DMA</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   Timer::setClockSource(<a name="a27"></a><a class="code" href="group___f_t_m___group.html#ggafc7a094fb1fe0a53ef14cab8a13f1f26a5b5204145075ffa09b52edb9b5318fea">FtmClockSource_Disabled</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Clear any old interrupts (DMA requests)</span></div><div class="line">   <span class="comment">// This only works because the FTM channels have DMA disabled at the moment!</span></div><div class="line">   Timer::clearSelectedInterruptFlags(ftmChannelMask);</div><div class="line"></div><div class="line">   <span class="comment">// Configure the three channels for DMA (timing is already set)</span></div><div class="line"><span class="preprocessor">#if 1</span></div><div class="line">   TimerSetChannel::configure(<a name="a28"></a><a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28ac8eb9a69494490cd72973b52b96e9cff">FtmChMode_OutputCompare</a>, <a name="a29"></a><a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2abda6fc05113c5177c40cd7f82550f5b5">FtmChannelAction_Dma</a>);</div><div class="line">   TimerDataChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28ac8eb9a69494490cd72973b52b96e9cff">FtmChMode_OutputCompare</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2abda6fc05113c5177c40cd7f82550f5b5">FtmChannelAction_Dma</a>);</div><div class="line">   TimerClearChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28ac8eb9a69494490cd72973b52b96e9cff">FtmChMode_OutputCompare</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2abda6fc05113c5177c40cd7f82550f5b5">FtmChannelAction_Dma</a>);</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">   <span class="comment">// For debug - output FTM channels to pins</span></div><div class="line">   TimerSetChannel::configure(<a name="a30"></a><a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28a6fd88a64c228b37859f5795b85df8d52">FtmChMode_OutputCompareToggle</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2abda6fc05113c5177c40cd7f82550f5b5">FtmChannelAction_Dma</a>);</div><div class="line">   TimerDataChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28a6fd88a64c228b37859f5795b85df8d52">FtmChMode_OutputCompareToggle</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2abda6fc05113c5177c40cd7f82550f5b5">FtmChannelAction_Dma</a>);</div><div class="line">   TimerClearChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28a6fd88a64c228b37859f5795b85df8d52">FtmChMode_OutputCompareToggle</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2abda6fc05113c5177c40cd7f82550f5b5">FtmChannelAction_Dma</a>);</div><div class="line"></div><div class="line">   Timer::setChanelOutputs(0);</div><div class="line"></div><div class="line">   TimerSetChannel::setOutput();</div><div class="line">   TimerDataChannel::setOutput();</div><div class="line">   TimerClearChannel::setOutput();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">   <span class="comment">// Enable timer-&gt;DMA hardware requests</span></div><div class="line">   <a name="a31"></a><a class="code" href="class_u_s_b_d_m_1_1_dma_base___t.html#a38bd13aace7613d66bd44252fe46c817">Dma0::enableMultipleRequests</a>(dmaChannelMask);</div><div class="line"></div><div class="line">   <span class="comment">// Restart the counter from zero so sequence starts in correct order</span></div><div class="line">   Timer::resetTime();</div><div class="line"></div><div class="line">   <span class="comment">// Restore clock</span></div><div class="line">   Timer::setClockSource(<a name="a32"></a><a class="code" href="group___f_t_m___group.html#ggafc7a094fb1fe0a53ef14cab8a13f1f26a000ddd189183dd9c41bcdf4809dc83f5">FtmClockSource_System</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Check if configuration failed</span></div><div class="line">   <a class="code" href="namespace_u_s_b_d_m.html#ab59696ecaf96d6ee79249ea003869d7a">checkError</a>();</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Base initialisation of FTM</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> initialiseFtm() {<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * FTM set up as required for Output Compare</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="comment">// Configure base FTM (affects all channels)</span></div><div class="line">   <a name="a33"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#a8ffb60de00f511c28ff41dcfba30b462">Timer::configure</a>(</div><div class="line">         <a name="a34"></a><a class="code" href="group___f_t_m___group.html#ggac56a93d073d805c5722711233a0d5ad4ab25594c952e749ea152dd3e752f7460e">FtmMode_LeftAlign</a>,      <span class="comment">// Left-aligned is required for OC/IC</span></div><div class="line">         <a class="code" href="group___f_t_m___group.html#ggafc7a094fb1fe0a53ef14cab8a13f1f26a000ddd189183dd9c41bcdf4809dc83f5">FtmClockSource_System</a>); <span class="comment">// System clock</span></div><div class="line"></div><div class="line">   <span class="comment">// Set required Timer period.</span></div><div class="line">   <span class="comment">// Note that this requires the counter clock to have been already set</span></div><div class="line">   <a name="a35"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#a6ef874c8dc98c11c1d26d1ace4a8b27f">Timer::setPeriod</a>(PERIOD);</div><div class="line"></div><div class="line">   <span class="comment">// Configure the channels for O.C so event times can be set - no DMA initially</span></div><div class="line">   TimerSetChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28ac8eb9a69494490cd72973b52b96e9cff">FtmChMode_OutputCompare</a>, <a name="a36"></a><a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2a2427fb7e1626645710e3f97fa965a6e3">FtmChannelAction_None</a>);</div><div class="line">   TimerDataChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28ac8eb9a69494490cd72973b52b96e9cff">FtmChMode_OutputCompare</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2a2427fb7e1626645710e3f97fa965a6e3">FtmChannelAction_None</a>);</div><div class="line">   TimerClearChannel::configure(<a class="code" href="group___f_t_m___group.html#ggaaeb86e82840c002f98b3a692ab7b1a28ac8eb9a69494490cd72973b52b96e9cff">FtmChMode_OutputCompare</a>, <a class="code" href="group___f_t_m___group.html#ggab09b5f21e456c34597c880a36d2695c2a2427fb7e1626645710e3f97fa965a6e3">FtmChannelAction_None</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Set channel event times</span></div><div class="line">   TimerSetChannel::setEventTime(0);</div><div class="line">   TimerDataChannel::setEventTime(<a name="a37"></a><a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#a11e52a1827111245e907722ddd89542d">Timer::convertSecondsToTicks</a>(T0_HIGH));</div><div class="line">   TimerClearChannel::setEventTime(<a class="code" href="class_u_s_b_d_m_1_1_pit_base___t.html#a11e52a1827111245e907722ddd89542d">Timer::convertSecondsToTicks</a>(T1_HIGH));</div><div class="line"></div><div class="line">   <span class="comment">// Check if configuration failed</span></div><div class="line">   <a class="code" href="namespace_u_s_b_d_m.html#ab59696ecaf96d6ee79249ea003869d7a">checkError</a>();</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Initialise the GPIO pins driving the Neopixel</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> initialisePins() {</div><div class="line">   Pixel::setOutput(<a name="a38"></a><a class="code" href="group___peripheral_pin_tables.html#gga41b0e776b3badb014a0fa2c3261d4c57a2f1142550360f67b113d19b07c3526c7">PinDriveStrength_High</a>);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Write pixel buffer to LEDs</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param pixel0Data</span></div><div class="line"><span class="comment"> * @param pixel1Data</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> writeLEDs(<span class="keyword">const</span> uint32_t *pixel0Data, <span class="keyword">const</span> uint32_t *pixel1Data) {</div><div class="line">   <span class="comment">//   console.writeln(&quot;Starting Transfer&quot;);</span></div><div class="line"></div><div class="line">   unpackPixels(Pixel::mask(0), pixel0Data);</div><div class="line">   unpackPixels(Pixel::mask(1), pixel1Data);</div><div class="line"></div><div class="line">   <span class="comment">// Start transfer</span></div><div class="line">   startTransfer(<a name="a39"></a><a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19ade683904fdaefeee7a5f5531311776bf">DmaChannelNum_0</a>, <a name="a40"></a><a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19aa4619a361fdcfe78fb3c784d5ae738f4">DmaChannelNum_1</a>, <a name="a41"></a><a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19a733a75aeb664dac308ded701aa7c1148">DmaChannelNum_2</a>);</div><div class="line"></div><div class="line">   <span class="comment">// Wait for completion of 1 Major-loop = 1 pixelBuffer transfer</span></div><div class="line">   <span class="keywordflow">while</span> (!complete) {</div><div class="line">      <a name="a42"></a><a class="code" href="class_u_s_b_d_m_1_1_smc_base___t.html#a24dd5ecbd3c8a6d0b30076ee6a423f96">Smc::enterWaitMode</a>();</div><div class="line">   }</div><div class="line">   <span class="comment">//   console.writeln(&quot;Transfer complete&quot;);</span></div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Construct RGB value from individual RGB bytes</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] red</span></div><div class="line"><span class="comment"> * @param[in] green</span></div><div class="line"><span class="comment"> * @param[in] blue</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return 24-bit RG value</span></div><div class="line"><span class="comment"> */</span></div><div class="line">constexpr uint32_t rgb(uint8_t red, uint8_t green, uint8_t blue) {</div><div class="line">   <span class="keywordflow">return</span> (red&lt;&lt;16)|(green&lt;&lt;8)|blue;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Extract red component from RGB colour</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] rgb</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Extracted component</span></div><div class="line"><span class="comment"> */</span></div><div class="line">constexpr uint8_t red(uint32_t rgb) {</div><div class="line">   <span class="keywordflow">return</span> (rgb&gt;&gt;16)&amp;0xFF;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Extract green component from RGB colour</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] rgb</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Extracted component</span></div><div class="line"><span class="comment"> */</span></div><div class="line">constexpr uint8_t green(uint32_t rgb) {</div><div class="line">   <span class="keywordflow">return</span> (rgb&gt;&gt;8)&amp;0xFF;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Extract blue component from RGB colour</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] rgb</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Extracted component</span></div><div class="line"><span class="comment"> */</span></div><div class="line">constexpr uint8_t blue(uint32_t rgb) {</div><div class="line">   <span class="keywordflow">return</span> rgb&amp;0xFF;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Calculate an intermediate colour</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in] from          1st colour</span></div><div class="line"><span class="comment"> * @param[in] to            2nd colour</span></div><div class="line"><span class="comment"> * @param[in] percentage    Controls the percentage of each colour included in the result</span></div><div class="line"><span class="comment"> * @param[in] brightness    Weighting for overall brightness (percent)</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return  Intermediate colour = (((100-percentage)*from) + (percentage*to))/100;</span></div><div class="line"><span class="comment"> */</span></div><div class="line">uint32_t mix(uint32_t from, uint32_t to, <span class="keywordtype">int</span> percentage, <span class="keywordtype">int</span> brightness=100) {</div><div class="line"></div><div class="line">   uint8_t r = brightness*(((100-percentage)*red(from))   + (percentage*red(to)))/10000;</div><div class="line">   uint8_t g = brightness*(((100-percentage)*green(from)) + (percentage*green(to)))/10000;</div><div class="line">   uint8_t b = brightness*(((100-percentage)*blue(from))  + (percentage*blue(to)))/10000;</div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> rgb(r,g,b);</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> *  Pan LEDs between colours</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param[in]    from       Colour to pan from (current colour)</span></div><div class="line"><span class="comment"> * @param[in]    to         Colour to pan to</span></div><div class="line"><span class="comment"> * @param[in]    delay      Delay between changes (milliseconds)</span></div><div class="line"><span class="comment"> * @param[inout] pixelData  Buffer for persistent pixel data</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> panLeds(uint32_t from, uint32_t to, <span class="keywordtype">int</span> delay, uint32_t pixelData[PIXEL_LENGTH]) {</div><div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> percentage=0; percentage&lt;=100; percentage+=10) {</div><div class="line">      memmove(pixelData, pixelData+1, (PIXEL_LENGTH-1)*<span class="keyword">sizeof</span>(*pixelData));</div><div class="line">      pixelData[PIXEL_LENGTH-1] = mix(from, to, percentage, 100);</div><div class="line">      writeLEDs(pixelData, pixelData);</div><div class="line">      <a name="a43"></a><a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(delay);</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Pan between random colours</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> animate1() {</div><div class="line">   <span class="comment">// Delay between changes</span></div><div class="line">   constexpr <span class="keywordtype">int</span> DELAY_VALUE = 100;</div><div class="line"></div><div class="line">   <span class="comment">// Buffer for pixel data</span></div><div class="line">   uint32_t pixelData[PIXEL_LENGTH];</div><div class="line"></div><div class="line">   <span class="comment">// Clear buffer initially</span></div><div class="line">   memset(pixelData, 0, <span class="keyword">sizeof</span>(pixelData));</div><div class="line"></div><div class="line">   <span class="comment">// Pan from off</span></div><div class="line">   uint32_t to, from = rgb(0,0,0);</div><div class="line"></div><div class="line">   <span class="comment">// Pan between random colours</span></div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      to = rgb(rand()%256,rand()%256,rand()%256);</div><div class="line">      panLeds(from, to, DELAY_VALUE, pixelData);</div><div class="line">      from = to;</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Pan between random colours from a table</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> animate2() {</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t colours[] = {</div><div class="line">         rgb(  0,   0, 255),</div><div class="line">         rgb(  0, 255,   0),</div><div class="line">         rgb(255,   0,   0),</div><div class="line">         rgb(  0, 255, 255),</div><div class="line">         rgb(255, 255,   0),</div><div class="line">         rgb(255,   0, 255),</div><div class="line">         rgb(255, 255, 255),</div><div class="line">   };</div><div class="line"></div><div class="line">   <span class="comment">// Delay between changes</span></div><div class="line">   constexpr <span class="keywordtype">int</span> DELAY_VALUE = 100;</div><div class="line"></div><div class="line">   <span class="comment">// Buffer for pixel data</span></div><div class="line">   uint32_t pixelData[PIXEL_LENGTH];</div><div class="line"></div><div class="line">   <span class="comment">// Clear buffer initially</span></div><div class="line">   memset(pixelData, 0, <span class="keyword">sizeof</span>(pixelData));</div><div class="line"></div><div class="line">   <span class="comment">// Pan between random colours from array</span></div><div class="line">   uint32_t to, from = rgb(0,0,0);</div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      to   = colours[rand()%(<span class="keyword">sizeof</span>(colours)/<span class="keyword">sizeof</span>(colours[0]))];</div><div class="line">      panLeds(from, to, DELAY_VALUE, pixelData);</div><div class="line">      from = to;</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Change to colours from a table</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> animate3() {</div><div class="line"></div><div class="line">   <span class="comment">// Delay between changes</span></div><div class="line">   constexpr <span class="keywordtype">int</span> DELAY_VALUE = 100;</div><div class="line"></div><div class="line"><span class="preprocessor">#if 0</span></div><div class="line">   uint32_t pixels[PIXEL_LENGTH];</div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;;i+=100) {</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0; j&lt;(PIXEL_LENGTH);j++) {</div><div class="line">         pixels[j] = i;</div><div class="line">         i += 0x010101;</div><div class="line">      }</div><div class="line">      writeLEDs(pixels, pixels);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(100);</div><div class="line">   }</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">   <span class="comment">//                                       RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB</span></div><div class="line">   <span class="comment">//   uint32_t pixel0Data[PIXEL_LENGTH]  = { 0x341256, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, 0x221133, };</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataA[PIXEL_LENGTH] = { 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataB[PIXEL_LENGTH] = { 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataC[PIXEL_LENGTH] = { 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataD[PIXEL_LENGTH] = { 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataE[PIXEL_LENGTH] = { 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataF[PIXEL_LENGTH] = { 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataG[PIXEL_LENGTH] = { 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataH[PIXEL_LENGTH] = { 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataI[PIXEL_LENGTH] = { 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataJ[PIXEL_LENGTH] = { 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataK[PIXEL_LENGTH] = { 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, };</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataL[PIXEL_LENGTH] = { 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, };</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      writeLEDs(pixel1DataB, pixel1DataL);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataA, pixel1DataK);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataC, pixel1DataJ);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataD, pixel1DataI);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataE, pixel1DataH);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataF, pixel1DataG);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataG, pixel1DataF);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataH, pixel1DataE);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataI, pixel1DataD);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataJ, pixel1DataC);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataK, pixel1DataB);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">      writeLEDs(pixel1DataL, pixel1DataA);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">   }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Sends fixed pattern for testing timing</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> test() {</div><div class="line"></div><div class="line">   <span class="comment">// Delay between changes</span></div><div class="line">   constexpr <span class="keywordtype">int</span> DELAY_VALUE = 100;</div><div class="line"></div><div class="line">   <span class="comment">//                                                    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint32_t pixel1DataA[PIXEL_LENGTH] = { 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, 0x0000FF, 0x00FF00, 0xFF0000, 0xFFFF00, 0xFF00FF, 0x00FFFF, };</div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      writeLEDs(pixel1DataA, pixel1DataA);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Sends fixed pattern for testing timing</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> testRandom() {</div><div class="line"></div><div class="line">   <span class="comment">// Delay between changes</span></div><div class="line">   constexpr <span class="keywordtype">int</span> DELAY_VALUE = 100;</div><div class="line"></div><div class="line">   <span class="comment">//                                 RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB    RRGGBB</span></div><div class="line">   <span class="keyword">static</span> uint32_t pixel1DataA[] = {0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, 0xFFFFFF, };</div><div class="line">   <span class="keywordflow">for</span>(;;) {</div><div class="line">      uint32_t value = rand();</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index=0; index&lt;PIXEL_LENGTH; index++) {</div><div class="line">         pixel1DataA[index] = value;</div><div class="line">      }</div><div class="line">      writeLEDs(pixel1DataA, pixel1DataA);</div><div class="line">      <a class="code" href="namespace_u_s_b_d_m.html#ad4b50dfe4106221f5205e2b2137cb492">waitMS</a>(DELAY_VALUE);</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Demonstration main-line</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return Not used.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span> <a name="a44"></a><a class="code" href="mma845x-example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line"></div><div class="line">   initialisePins();</div><div class="line"></div><div class="line">   initialiseFtm();</div><div class="line"></div><div class="line">   initialiseDma(<a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19ade683904fdaefeee7a5f5531311776bf">DmaChannelNum_0</a>, <a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19aa4619a361fdcfe78fb3c784d5ae738f4">DmaChannelNum_1</a>, <a class="code" href="group___d_m_a___group.html#gga0801cb7745e0122855939ce6fabbef19a733a75aeb664dac308ded701aa7c1148">DmaChannelNum_2</a>);</div><div class="line"></div><div class="line"><span class="comment">//   testRandom();</span></div><div class="line"></div><div class="line">   animate2();</div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 31 2019 16:45:43 for Lab5_Section2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
